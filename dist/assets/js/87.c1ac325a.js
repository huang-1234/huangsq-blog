(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{598:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jsäº‹ä»¶å¾ªç¯-event-loop-full"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsäº‹ä»¶å¾ªç¯-event-loop-full"}},[t._v("#")]),t._v(" JSäº‹ä»¶å¾ªç¯(Event Loop) Full")]),t._v(" "),a("h3",{attrs:{id:"æ¦‚å¿µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚å¿µ"}},[t._v("#")]),t._v(" æ¦‚å¿µ")]),t._v(" "),a("p",[t._v("JavaScript æœ‰ä¸€ä¸ªåŸºäºäº‹ä»¶å¾ªç¯çš„å¹¶å‘æ¨¡å‹ï¼Œäº‹ä»¶å¾ªç¯è´Ÿè´£æ‰§è¡Œä»£ç ã€æ”¶é›†å’Œå¤„ç†äº‹ä»¶ä»¥åŠæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å­ä»»åŠ¡ã€‚è¿™ä¸ªæ¨¡å‹ä¸å…¶å®ƒè¯­è¨€ä¸­çš„æ¨¡å‹æˆªç„¶ä¸åŒï¼Œæ¯”å¦‚ C å’Œ Javaã€‚"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop",target:"_blank",rel:"noopener noreferrer"}},[t._v("ï¼ˆæ‘˜è‡ªMDNï¼‰"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("ç®€å•åœ°è¯´ï¼Œå¯¹äº JS è¿è¡Œä¸­çš„ä»»åŠ¡ï¼ŒJS æœ‰ä¸€å¥—å¤„ç†æ”¶é›†ï¼Œæ’é˜Ÿï¼Œæ‰§è¡Œçš„ç‰¹æ®Šæœºåˆ¶ï¼Œæˆ‘ä»¬æŠŠè¿™å¥—å¤„ç†æœºåˆ¶ç§°ä¸ºäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ã€‚")]),t._v(" "),a("p",[t._v("ä¸ºäº†æ›´æ·±åˆ»çš„ç†è§£äº‹ä»¶å¾ªç¯ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªç›¸å…³æ¦‚å¿µ")]),t._v(" "),a("h4",{attrs:{id:"å•çº¿ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å•çº¿ç¨‹"}},[t._v("#")]),t._v(" å•çº¿ç¨‹")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬éƒ½çŸ¥é“ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ")]),t._v(" "),a("p",[t._v("JS å•çº¿ç¨‹æŒ‡çš„æ˜¯ javascript å¼•æ“ï¼ˆå¦‚V8ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("æœ‰äººæˆ–è®¸ä¼šé—®ï¼Œå¼‚æ­¥ä»»åŠ¡ ajax éš¾é“ä¸æ˜¯å¯ä»¥å’Œ JS ä»£ç åŒæ—¶æ‰§è¡Œä¹ˆï¼Ÿ")]),t._v(" "),a("p",[t._v("ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¿™å’Œ JS å•çº¿ç¨‹å¹¶ä¸å†²çªï¼Œå‰é¢è¯´è¿‡ javascript å¼•æ“ï¼ˆå¦‚V8ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚ä½†è¿™å¹¶ä¸æ˜¯è¯´æµè§ˆå™¨åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä»¶äº‹æƒ…ï¼Œå®é™…ä¸Š ajax ç­‰å¼‚æ­¥ä»»åŠ¡ä¸æ˜¯åœ¨ JS å¼•æ“ä¸Šè¿è¡Œçš„ï¼Œajax åœ¨æµè§ˆå™¨å¤„ç†ç½‘ç»œçš„æ¨¡å—ä¸­æ‰§è¡Œï¼Œæ­¤æ—¶ä¸ä¼šå½±å“åˆ° JS å¼•æ“çš„ä»»åŠ¡å¤„ç†ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¡¨ç¤ºæ­¤æ—¶å¤„ç†çš„åªæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œ\næˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªæ­£åœ¨å¤„ç†çš„å‡½æ•°ï¼ŒåŒæ—¶æ‹¥æœ‰å¤šä¸ªæ‰§è¡Œç¯å¢ƒï¼Œåé¢ä¼šæœ‰åˆ†æã€‚\n")])])]),a("h3",{attrs:{id:"æ‰§è¡Œç¯å¢ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‰§è¡Œç¯å¢ƒ"}},[t._v("#")]),t._v(" æ‰§è¡Œç¯å¢ƒ")]),t._v(" "),a("p",[t._v("å…³äºæ‰§è¡Œç¯å¢ƒå¯ä»¥å‚è€ƒ")]),t._v(" "),a("p",[t._v("æ‰§è¡Œç¯å¢ƒæ˜¯ JS ä»£ç è¯­å¥æ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒ…æ‹¬å…¨å±€æ‰§è¡Œç¯å¢ƒå’Œå‡½æ•°æ‰§è¡Œç¯å¢ƒã€‚")]),t._v(" "),a("ul",[a("li",[t._v("å…¨å±€æ‰§è¡Œç¯å¢ƒï¼šå…¨å±€ç¯å¢ƒæ˜¯æœ€å¤–å›´çš„ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œæ ¹æ®ECMAScriptå®ç°æ‰€åœ¨çš„å®¿ä¸»ç¯å¢ƒä¸åŒï¼Œè¡¨ç¤ºæ‰§è¡Œç¯å¢ƒçš„å¯¹è±¡ä¹Ÿä¸ä¸€æ ·ï¼Œåœ¨webä¸­ï¼Œå…¨å±€æ‰§è¡Œç¯å¢ƒè¢«è®¤ä¸ºæ˜¯windowå¯¹è±¡ã€‚")]),t._v(" "),a("li",[t._v("å‡½æ•°æ‰§è¡Œç¯å¢ƒï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œç¯å¢ƒã€‚")])]),t._v(" "),a("p",[t._v("å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œç›¸åº”çš„ä¼šå¯¹åº”ä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„æ‰§è¡Œç¯å¢ƒæ ˆï¼Œè¿™ä¸ªæ‰§è¡Œç¯å¢ƒæ ˆåŒ…æ‹¬äº†ä¸åŒçš„æ‰§è¡Œç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„ç»“æ„ã€‚")]),t._v(" "),a("p",[t._v("ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œç¯å¢ƒæ ˆçš„åŠ¨æ€å˜åŒ–")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤æ—¶")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"å˜é‡å¯¹è±¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡å¯¹è±¡"}},[t._v("#")]),t._v(" å˜é‡å¯¹è±¡")]),t._v(" "),a("p",[t._v("æ¯ä¸ªæ‰§è¡Œç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªå˜é‡å¯¹è±¡ä¸ä¹‹å…³è”ï¼ˆä¸€ä¸€å¯¹åº”ï¼‰ï¼Œå˜é‡å¯¹è±¡åŒ…å«äº†æ‰§è¡Œç¯å¢ƒä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡åŠå‡½æ•°ã€‚ï¼ˆåœ¨æ­¤å¤„å¯ä»¥æ€è€ƒä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬æå€¡å°½é‡å°‘åˆ›å»ºå…¨å±€å˜é‡ï¼Œç­”æ¡ˆå°±æ˜¯å› ä¸ºå…¨å±€ç¯å¢ƒå¯¹åº”çš„å˜é‡å¯¹è±¡ä¸€ç›´ä¼šå­˜åœ¨å†…å­˜ä¸­ã€‚ï¼‰")]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¾ªç¯æœºåˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªç¯æœºåˆ¶"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªç¯æœºåˆ¶")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬å…ˆçœ‹çœ‹ MDN ä¸Šçš„ä¸€å¼ å›¾ç‰‡\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201444501-1827901668.png"),alt:"mixureSecure"}})]),t._v(" "),a("p",[t._v("ä¸Šé¢è¿™å¼ å›¾å¾ˆå¥½åœ°å±•ç¤ºäº† JS ä¸­çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ä¸­ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒStackï¼ŒHeapï¼ŒQueueï¼Œä¸‹é¢é€ä¸ªåˆ†æã€‚")]),t._v(" "),a("ul",[a("li",[t._v("Stack è¡¨ç¤ºè®¡ç®—æœºçš„æ ˆç»“æ„ï¼Œæ­¤å¤„ Stack åŒºåŸŸè¡¨ç¤ºçš„æ˜¯å½“å‰ JS çº¿ç¨‹æ­£åœ¨å¤„ç†çš„ä»»åŠ¡(ä¸€ä¸ªä»»åŠ¡)ã€‚ç»“åˆæ‰§è¡Œç¯å¢ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æŠŠè¿™äº› Frame çš„ç»„åˆå½“ä½œå½“å‰çš„æ‰§è¡Œç¯å¢ƒæ ˆã€‚ä¸€ä¸ª Frame è¡¨ç¤ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒã€‚è¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸€ä¸ªä»»åŠ¡ä¸‹å…¶å®å¯ä»¥åŒ…å«å¤šä¸ªç›¸å…³å‡½æ•°ã€‚")]),t._v(" "),a("li",[t._v("Heap ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºè®¡ç®—æœºå†…å­˜ï¼Œæ­¤å¤„ Heap è¡¨ç¤ºå½“å‰ä»»åŠ¡ä¸‹ç›¸å…³çš„æ•°æ®ï¼Œç»“åˆä¸Šé¢å˜é‡å¯¹è±¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…¶ä¸­çš„ Object æ ‡ç­¾å½“ä½œæ˜¯æ‰§è¡Œç¯å¢ƒå¯¹åº”çš„å˜é‡å¯¹è±¡ã€‚ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒæ¨å…¥æ‰§è¡Œç¯å¢ƒæ ˆæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå˜é‡å¯¹è±¡æ”¾å…¥ Heap åŒºåŸŸï¼Œå½“æ‰§è¡Œç¯å¢ƒæ ˆæ¨å‡ºè¿™ä¸ªæ‰§è¡Œç¯å¢ƒæ—¶ï¼Œå…¶ç›¸å¯¹åº”çš„å˜é‡å¯¹è±¡åœ¨ Heap ç§»é™¤å¹¶é”€æ¯ã€‚å¦‚æœå†æ·±å…¥ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé‡Œé¢ Object çš„é›†åˆå…¶å®å°±æ˜¯æˆ‘ä»¬çš„ä½œç”¨åŸŸé“¾çš„å˜é‡å¯¹è±¡é›†åˆã€‚")]),t._v(" "),a("li",[t._v("Queue åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºé˜Ÿåˆ—ï¼Œæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ã€‚æ­¤å¤„ Queue åŒºè¡¨ç¤ºäº†å½“å‰æ­£åœ¨æ’é˜Ÿçš„ä»»åŠ¡é›†åˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä»»åŠ¡é˜Ÿåˆ—ã€‚ä¸€ä¸ª Message è¡¨ç¤ºä¸€ä¸ªå¾…æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒä»¬æ˜¯æŒ‰é¡ºåºæ’é˜Ÿçš„ã€‚")])]),t._v(" "),a("p",[t._v("åˆ†æå®Œå›¾ç‰‡çš„ä¸åŒåŒºåŸŸï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°åˆ†æå‡ºè¿™å¼ å›¾ä¸­é˜é‡Šçš„äº‹ä»¶ç¯å¢ƒæœºåˆ¶äº†")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼ŒæœŸé—´å¯èƒ½åˆ›å»ºå¤šä¸ªå‡½æ•°æ‰§è¡Œç¯å¢ƒï¼Œå¯¹åº” Frameã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œéšæ—¶æ‰§è¡Œç¯å¢ƒæ ˆçš„åŠ¨æ€å˜åŒ–ï¼Œç›¸å¯¹åº”çš„å˜é‡å¯¹è±¡ä¸æ–­åˆ›å»ºé”€æ¯ï¼Œå¯¹åº” Objectã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" å¼‚æ­¥ä»»åŠ¡ ajax "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("O")]),t._v(" ç­‰å¾—åˆ°ç»“æœæ—¶ï¼Œä¼šå°†å…¶å›è°ƒä½œä¸ºä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" å½“ "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ— Queueï¼Œå¹¶å°†é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ° "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹ä¸­å¹¶æ‰§è¡Œã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.")]),t._v(" å¾ªç¯ "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" æ­¥ï¼Œå¼‚æ­¥ä»»åŠ¡å®Œæˆåä¸æ–­åœ°å¾€ä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œçº¿ç¨‹ç©ºé—²æ—¶ä»ä»»åŠ¡åˆ—è¡¨è¯»å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚\n")])])]),a("h3",{attrs:{id:"äº‹ä»¶å¾ªç¯ä¸‹çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªç¯ä¸‹çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªç¯ä¸‹çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡")]),t._v(" "),a("p",[t._v("é€šå¸¸æˆ‘ä»¬æŠŠå¼‚æ­¥ä»»åŠ¡åˆ†ä¸ºå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ï¼Œå®ƒä»¬çš„åŒºåˆ†åœ¨äºï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å®ä»»åŠ¡ï¼ˆmacro-taskï¼‰ï¼šä¸€èˆ¬æ˜¯ JS å¼•æ“å’Œå®¿ä¸»ç¯å¢ƒå‘ç”Ÿé€šä¿¡äº§ç”Ÿçš„å›è°ƒä»»åŠ¡ï¼Œæ¯”å¦‚ setTimeoutï¼ŒsetInterval æ˜¯æµè§ˆå™¨è¿›è¡Œè®¡æ—¶çš„ï¼Œå…¶ä¸­å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶é—´éœ€è¦æµè§ˆå™¨é€šçŸ¥åˆ° JS å¼•æ“ï¼Œç½‘ç»œæ¨¡å—, I/Oå¤„ç†çš„é€šä¿¡å›è°ƒä¹Ÿæ˜¯ã€‚åŒ…å«æœ‰ setTimeoutï¼ŒsetIntervalï¼ŒDOMäº‹ä»¶å›è°ƒï¼Œajaxè¯·æ±‚ç»“æŸåçš„å›è°ƒï¼Œæ•´ä½“ script ä»£ç ï¼ŒsetImmediateã€‚")]),t._v(" "),a("li",[t._v("å¾®ä»»åŠ¡ï¼ˆmicro-taskï¼‰ï¼šä¸€èˆ¬æ˜¯å®ä»»åŠ¡åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶äº§ç”Ÿçš„å›è°ƒï¼Œå¦‚ Promiseï¼Œprocess.nextTickï¼ŒObject.observe(å·²åºŸå¼ƒ)ï¼Œ MutationObserverï¼ˆDOMç›‘å¬ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯ JS å¼•æ“è‡ªèº«å¯ä»¥ç›‘å¬åˆ°å›è°ƒã€‚")])]),t._v(" "),a("p",[t._v("ä¸Šé¢æˆ‘ä»¬äº†è§£äº†å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡çš„åˆ†ç±»ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å°†å…¶åˆ†ä¸ºå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå…¶æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—çš„æœºåˆ¶ä¸åŒã€‚")]),t._v(" "),a("p",[t._v("åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œä»»åŠ¡ä¸€èˆ¬éƒ½æ˜¯ç”±å®ä»»åŠ¡å¼€å§‹æ‰§è¡Œçš„ï¼ˆJSä»£ç çš„åŠ è½½æ‰§è¡Œï¼‰ï¼Œåœ¨å®ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ–°çš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œè¿™æ—¶å€™å®ä»»åŠ¡ï¼ˆå¦‚ajaxå›è°ƒï¼‰ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…äº‹ä»¶å¾ªç¯æœºåˆ¶æ‰§è¡Œï¼Œè€Œå¾®ä»»åŠ¡åˆ™ä¼šè¢«æ·»åŠ åˆ°å½“å‰ä»»åŠ¡é˜Ÿåˆ—çš„å‰ç«¯ï¼Œä¹Ÿæ˜¯ç­‰å¾…äº‹ä»¶å¾ªç¯æœºåˆ¶çš„æ‰§è¡Œã€‚")]),t._v(" "),a("p",[t._v("å…¶ä¸­ç›¸åŒç±»å‹çš„å®ä»»åŠ¡æˆ–å¾®ä»»åŠ¡ä¼šæŒ‰ç…§å›è°ƒçš„å…ˆåé¡ºåºè¿›è¡Œæ’åºï¼Œè€Œä¸åŒä»»åŠ¡ç±»å‹çš„ä»»åŠ¡ä¼šæœ‰ä¸€å®šçš„ä¼˜å…ˆçº§ï¼ŒæŒ‰ç…§ä¸åŒç±»å‹ä»»åŠ¡åŒºåˆ†")]),t._v(" "),a("p",[t._v("å®ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä¸»ä»£ç å— > setImmediate > MessageChannel > setTimeout / setInterval")]),t._v(" "),a("p",[t._v("å¾®ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œprocess.nextTick > Promise > MutationObserver\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201508564-925237420.png"),alt:"mixureSecure"}})]),t._v(" "),a("p",[t._v("ä¸¾ä¸ªğŸŒ°")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬æ¥åˆ†æä¸‹é¢è¿™æ®µä»£ç çš„æ‰“å°é¡ºåº")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setTimeout1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setTimeout2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("æˆ‘ä»¬å‡è®¾è¿™æ®µä»£ç æ­£åœ¨ JS çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆscript ä»£ç å±äºå®ä»»åŠ¡ï¼‰ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™äº§ç”Ÿäº†ä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼ŒsetTimeout å’Œ Promiseã€‚å…¶ä¸­ setTimeout ä¸ºå®ä»»åŠ¡ï¼ŒPromise å±äºå¾®ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("æ ¹æ®ä¸Šé¢çš„å®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡çš„åœ¨ä»»åŠ¡é˜Ÿåˆ—çš„æ·»åŠ æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—å°†å¦‚ä¸‹æ‰€ç¤º\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201526461-715634913.png"),alt:"mixureSecure"}}),t._v("\nåˆ†æå‡ºäº†ä»»åŠ¡é˜Ÿåˆ—åï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾å¾—åˆ°æ‰“å°é¡ºåºäº†")]),t._v(" "),a("p",[t._v("é¦–å…ˆæ‰§è¡Œå®ä»»åŠ¡ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ‰§è¡Œé¡ºåºä¾æ¬¡æ‰“å° 4 5 7")]),t._v(" "),a("p",[t._v("æ¥ç€æŒ‰ç…§ä»»åŠ¡é˜Ÿåˆ—çš„å…ˆåé¡ºåºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œä¾æ¬¡æ‰“å° 6 8 1 2 3")]),t._v(" "),a("h1",{attrs:{id:"æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶-æµè§ˆå™¨ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶-æµè§ˆå™¨ç¯‡"}},[t._v("#")]),t._v(" æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆæµè§ˆå™¨ç¯‡ï¼‰")]),t._v(" "),a("h2",{attrs:{id:"æŠ›åœ¨å‰é¢çš„é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŠ›åœ¨å‰é¢çš„é—®é¢˜"}},[t._v("#")]),t._v(" æŠ›åœ¨å‰é¢çš„é—®é¢˜ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å•çº¿ç¨‹å¦‚ä½•åšåˆ°å¼‚æ­¥")]),t._v(" "),a("li",[t._v("äº‹ä»¶å¾ªç¯çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„")]),t._v(" "),a("li",[a("code",[t._v("macrotask")]),t._v(" å’Œ "),a("code",[t._v("microtask")]),t._v(" æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä½•åŒºåˆ«")])]),t._v(" "),a("h3",{attrs:{id:"å•çº¿ç¨‹å’Œå¼‚æ­¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å•çº¿ç¨‹å’Œå¼‚æ­¥"}},[t._v("#")]),t._v(" å•çº¿ç¨‹å’Œå¼‚æ­¥")]),t._v(" "),a("p",[t._v("æåˆ°jsï¼Œå°±ä¼šæƒ³åˆ°"),a("strong",[t._v("å•çº¿ç¨‹")]),t._v("ï¼Œ"),a("strong",[t._v("å¼‚æ­¥")]),t._v("ï¼Œé‚£ä¹ˆå•çº¿ç¨‹æ˜¯å¦‚ä½•åšåˆ°å¼‚æ­¥çš„å‘¢ï¼Ÿæ¦‚å¿µå…ˆè¡Œï¼Œå…ˆè¦äº†è§£ä¸‹å•çº¿ç¨‹å’Œå¼‚æ­¥ä¹‹é—´çš„å…³ç³»ã€‚")]),t._v(" "),a("p",[t._v("jsçš„ä»»åŠ¡åˆ†ä¸º "),a("em",[t._v("åŒæ­¥")]),t._v(" å’Œ "),a("em",[t._v("å¼‚æ­¥")]),t._v(" ä¸¤ç§ï¼Œå®ƒä»¬çš„å¤„ç†æ–¹å¼ä¹Ÿä¸åŒï¼Œ"),a("strong",[t._v("åŒæ­¥ä»»åŠ¡")]),t._v("æ˜¯ç›´æ¥åœ¨ä¸»çº¿ç¨‹ä¸Šæ’é˜Ÿæ‰§è¡Œï¼Œ"),a("strong",[t._v("å¼‚æ­¥ä»»åŠ¡")]),t._v("åˆ™ä¼šè¢«æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè‹¥æœ‰å¤šä¸ªä»»åŠ¡ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰åˆ™è¦åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…ï¼Œä»»åŠ¡é˜Ÿåˆ—ç±»ä¼¼ä¸€ä¸ªç¼“å†²åŒºï¼Œä»»åŠ¡ä¸‹ä¸€æ­¥ä¼šè¢«ç§»åˆ°"),a("strong",[t._v("è°ƒç”¨æ ˆ")]),t._v("ï¼ˆcall stackï¼‰ï¼Œç„¶åä¸»çº¿ç¨‹æ‰§è¡Œè°ƒç”¨æ ˆçš„ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("å•çº¿ç¨‹æ˜¯æŒ‡jså¼•æ“ä¸­è´Ÿè´£è§£ææ‰§è¡Œjsä»£ç çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼ˆ"),a("strong",[t._v("ä¸»çº¿ç¨‹")]),t._v("ï¼‰ï¼Œå³æ¯æ¬¡åªèƒ½åšä¸€ä»¶äº‹ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªajaxè¯·æ±‚ï¼Œä¸»çº¿ç¨‹åœ¨ç­‰å¾…å®ƒå“åº”çš„åŒæ—¶æ˜¯ä¼šå»åšå…¶å®ƒäº‹çš„ï¼Œæµè§ˆå™¨å…ˆåœ¨äº‹ä»¶è¡¨æ³¨å†Œajaxçš„å›è°ƒå‡½æ•°ï¼Œå“åº”å›æ¥åå›è°ƒå‡½æ•°è¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œä¸ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥è¯´jså¤„ç†ajaxè¯·æ±‚çš„æ–¹å¼æ˜¯å¼‚æ­¥çš„ã€‚")]),t._v(" "),a("p",[t._v("æ€»è€Œè¨€ä¹‹ï¼Œæ£€æŸ¥è°ƒç”¨æ ˆæ˜¯å¦ä¸ºç©ºï¼Œä»¥åŠç¡®å®šæŠŠå“ªä¸ªtaskåŠ å…¥è°ƒç”¨æ ˆçš„è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯"),a("strong",[t._v("äº‹ä»¶å¾ªç¯")]),t._v("ï¼Œè€Œ"),a("strong",[t._v("jså®ç°å¼‚æ­¥çš„æ ¸å¿ƒå°±æ˜¯äº‹ä»¶å¾ªç¯")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—"}},[t._v("#")]),t._v(" è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("p",[t._v("é¡¾åæ€ä¹‰ï¼Œè°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼Œå‡½æ•°è°ƒç”¨ä¼šå½¢æˆä¸€ä¸ªæ ˆå¸§ï¼Œå¸§ä¸­åŒ…å«äº†å½“å‰æ‰§è¡Œå‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå‡½æ•°æ‰§è¡Œå®Œåï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆä¸­å¼¹å‡ºã€‚")]),t._v(" "),a("p",[t._v("ä¸‹å›¾å°±æ˜¯è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—çš„å…³ç³»å›¾")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/callstack.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¾ªç¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªç¯"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªç¯")]),t._v(" "),a("p",[t._v("å…³äºäº‹ä»¶å¾ªç¯ï¼Œ"),a("a",{attrs:{href:"https://www.w3.org/TR/html5/webappapis.html#event-loop",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTMLè§„èŒƒ"),a("OutboundLink")],1),t._v("çš„ä»‹ç»")]),t._v(" "),a("blockquote",[a("p",[t._v("There must be at least one event loop per user agent, and at most one event loop per unit of related similar-origin browsing contexts.\nAn event loop has one or more task queues.\nEach task is defined as coming from a specific task source.")])]),t._v(" "),a("p",[t._v("ä»è§„èŒƒç†è§£ï¼Œæµè§ˆå™¨è‡³å°‘æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œä¸€ä¸ªäº‹ä»¶å¾ªç¯è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆmacrotaskï¼‰ï¼Œæ¯ä¸ªå¤–ä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„åˆ†ç»„ï¼Œæµè§ˆå™¨ä¼šä¸ºä¸åŒçš„ä»»åŠ¡ç»„è®¾ç½®ä¼˜å…ˆçº§ã€‚")]),t._v(" "),a("h3",{attrs:{id:"macrotask-microtask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#macrotask-microtask"}},[t._v("#")]),t._v(" macrotask & microtask")]),t._v(" "),a("p",[t._v("è§„èŒƒæœ‰æåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼Œä½†æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼ŒæŸ¥é˜…ä¸€äº›èµ„æ–™å¤§æ¦‚å¯æ€»ç»“å¦‚ä¸‹ï¼š")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("macrotask")]),t._v("ï¼šåŒ…å«æ‰§è¡Œæ•´ä½“çš„jsä»£ç ï¼Œäº‹ä»¶å›è°ƒï¼ŒXHRå›è°ƒï¼Œå®šæ—¶å™¨ï¼ˆsetTimeout/setInterval/setImmediateï¼‰ï¼ŒIOæ“ä½œï¼ŒUI render")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("microtask")]),t._v("ï¼šæ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬promiseå›è°ƒï¼ŒMutationObserverï¼Œprocess.nextTickï¼ŒObject.observe")])]),t._v(" "),a("p",[t._v("å…¶ä¸­"),a("code",[t._v("setImmediate")]),t._v("å’Œ"),a("code",[t._v("process.nextTick")]),t._v("æ˜¯nodejsçš„å®ç°ï¼Œåœ¨"),a("a",{attrs:{href:"http://lynnelv.github.io/js-event-loop-nodejs",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejsç¯‡"),a("OutboundLink")],1),t._v("ä¼šè¯¦ç»†ä»‹ç»ã€‚")]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¤„ç†è¿‡ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¤„ç†è¿‡ç¨‹"}},[t._v("#")]),t._v(" äº‹ä»¶å¤„ç†è¿‡ç¨‹")]),t._v(" "),a("p",[t._v("å…³äº"),a("code",[t._v("macrotask")]),t._v("å’Œ"),a("code",[t._v("microtask")]),t._v("çš„ç†è§£ï¼Œå…‰è¿™æ ·çœ‹ä¼šæœ‰äº›æ™¦æ¶©éš¾æ‡‚ï¼Œç»“åˆäº‹ä»¶å¾ªåçš„æœºåˆ¶ç†è§£æ¸…æ™°å¾ˆå¤šï¼Œä¸‹é¢è¿™å¼ å›¾å¯ä»¥è¯´æ˜¯ä»‹ç»å¾—éå¸¸æ¸…æ¥šäº†ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/event-loop.jpg",alt:"img"}})]),t._v(" "),a("p",[t._v("æ€»ç»“èµ·æ¥ï¼Œä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„æ­¥éª¤åŒ…æ‹¬ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("1. æ£€æŸ¥macrotaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œéç©ºåˆ™åˆ°2ï¼Œä¸ºç©ºåˆ™åˆ°3\n2. æ‰§è¡Œmacrotaskä¸­çš„ä¸€ä¸ªä»»åŠ¡\n3. ç»§ç»­æ£€æŸ¥microtaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œè‹¥æœ‰åˆ™åˆ°4ï¼Œå¦åˆ™åˆ°5\n4. å–å‡ºmicrotaskä¸­çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆè¿”å›åˆ°æ­¥éª¤3\n5. æ‰§è¡Œè§†å›¾æ›´æ–°\n")])])]),a("h3",{attrs:{id:"mactotask-microtaskçš„æ‰§è¡Œé¡ºåº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mactotask-microtaskçš„æ‰§è¡Œé¡ºåº"}},[t._v("#")]),t._v(" mactotask & microtaskçš„æ‰§è¡Œé¡ºåº")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/ma(i)crotask.png",alt:"img"}})]),t._v(" "),a("p",[t._v("è¯»å®Œè¿™ä¹ˆå¤šå¹²å·´å·´çš„æ¦‚å¿µä»‹ç»ï¼Œè¿˜ä¸å¦‚çœ‹ä¸€æ®µä»£ç æ„Ÿå—ä¸‹")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("æ‰“å°å°è¾“å‡ºçš„logé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿç»“åˆä¸Šè¿°çš„æ­¥éª¤åˆ†æï¼Œç³»ä¸ç³»so easy~"),a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/browser-deom1-excute-animate.gif",alt:"img"}})]),t._v(" "),a("p",[t._v("é¦–å…ˆï¼Œå…¨å±€ä»£ç ï¼ˆmain()ï¼‰å‹å…¥è°ƒç”¨æ ˆæ‰§è¡Œï¼Œæ‰“å°"),a("code",[t._v("start")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("æ¥ä¸‹æ¥setTimeoutå‹å…¥macrotaské˜Ÿåˆ—ï¼Œpromise.thenå›è°ƒæ”¾å…¥microtaské˜Ÿåˆ—ï¼Œæœ€åæ‰§è¡Œconsole.log(â€˜endâ€™)ï¼Œæ‰“å°å‡º"),a("code",[t._v("end")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è‡³æ­¤ï¼Œè°ƒç”¨æ ˆä¸­çš„ä»£ç è¢«æ‰§è¡Œå®Œæˆï¼Œå›é¡¾macrotaskçš„å®šä¹‰ï¼Œæˆ‘ä»¬çŸ¥é“å…¨å±€ä»£ç å±äºmacrotaskï¼Œmacrotaskæ‰§è¡Œå®Œï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œmicrotaské˜Ÿåˆ—çš„ä»»åŠ¡äº†ï¼Œæ‰§è¡Œpromiseå›è°ƒæ‰“å°"),a("code",[t._v("promise1")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("promiseå›è°ƒå‡½æ•°é»˜è®¤è¿”å›undefinedï¼ŒpromiseçŠ¶æ€å˜ä¸ºfullfillè§¦å‘æ¥ä¸‹æ¥çš„thenå›è°ƒï¼Œç»§ç»­å‹å…¥microtaské˜Ÿåˆ—ï¼Œ"),a("strong",[t._v("event loopä¼šæŠŠå½“å‰çš„microtaské˜Ÿåˆ—ä¸€ç›´æ‰§è¡Œå®Œ")]),t._v("ï¼Œæ­¤æ—¶æ‰§è¡Œç¬¬äºŒä¸ªpromise.thenå›è°ƒæ‰“å°å‡º"),a("code",[t._v("promise2")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è¿™æ—¶microtaské˜Ÿåˆ—å·²ç»ä¸ºç©ºï¼Œä»ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥çŸ¥é“ï¼Œæ¥ä¸‹æ¥ä¸»çº¿ç¨‹ä¼šå»åšä¸€äº›UIæ¸²æŸ“å·¥ä½œï¼ˆä¸ä¸€å®šä¼šåšï¼‰ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€è½®event loopï¼Œæ‰§è¡ŒsetTimeoutçš„å›è°ƒï¼Œæ‰“å°å‡º"),a("code",[t._v("setTimeout")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è¿™ä¸ªè¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„"),a("strong",[t._v("äº‹ä»¶å¾ªç¯")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"è§†å›¾æ¸²æŸ“çš„æ—¶æœº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è§†å›¾æ¸²æŸ“çš„æ—¶æœº"}},[t._v("#")]),t._v(" è§†å›¾æ¸²æŸ“çš„æ—¶æœº")]),t._v(" "),a("p",[t._v("å›é¡¾ä¸Šé¢çš„äº‹ä»¶å¾ªç¯ç¤ºæ„å›¾ï¼Œupdate renderingï¼ˆè§†å›¾æ¸²æŸ“ï¼‰å‘ç”Ÿåœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„microtaské˜Ÿåˆ—è¢«æ‰§è¡Œå®Œä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œä»»åŠ¡çš„è€—æ—¶ä¼šå½±å“è§†å›¾æ¸²æŸ“çš„æ—¶æœºã€‚é€šå¸¸æµè§ˆå™¨ä»¥æ¯ç§’60å¸§ï¼ˆ60fpsï¼‰çš„é€Ÿç‡åˆ·æ–°é¡µé¢ï¼Œæ®è¯´è¿™ä¸ªå¸§ç‡æœ€é€‚åˆäººçœ¼äº¤äº’ï¼Œå¤§æ¦‚16.7msæ¸²æŸ“ä¸€å¸§ï¼Œæ‰€ä»¥å¦‚æœè¦è®©ç”¨æˆ·è§‰å¾—é¡ºç•…ï¼Œå•ä¸ªmacrotaskåŠå®ƒç›¸å…³çš„æ‰€æœ‰microtaskæœ€å¥½èƒ½åœ¨16.7mså†…å®Œæˆã€‚")]),t._v(" "),a("p",[t._v("ä½†ä¹Ÿä¸æ˜¯æ¯è½®äº‹ä»¶å¾ªç¯éƒ½ä¼šæ‰§è¡Œè§†å›¾æ›´æ–°ï¼Œæµè§ˆå™¨æœ‰è‡ªå·±çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æŠŠå‡ æ¬¡çš„è§†å›¾æ›´æ–°ç´¯ç§¯åˆ°ä¸€èµ·é‡ç»˜ï¼Œé‡ç»˜ä¹‹å‰ä¼šé€šçŸ¥requestAnimationFrameæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´requestAnimationFrameå›è°ƒçš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸€æ¬¡æˆ–å¤šæ¬¡äº‹ä»¶å¾ªç¯çš„UI renderé˜¶æ®µã€‚")]),t._v(" "),a("p",[t._v("ä»¥ä¸‹ä»£ç å¯ä»¥éªŒè¯")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'requestAnimationFrame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise 1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise 2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise then'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* promise 1\npromise 2\nend\npromise then\nrequestAnimationFrame\ntimer1\ntimer2 */")]),t._v("\n")])])]),a("p",[t._v("å¯ä»¥çœ‹åˆ°ï¼Œç»“æœ1ä¸­"),a("code",[t._v("requestAnimationFrame()")]),t._v("æ˜¯åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯åæ‰§è¡Œï¼Œè€Œåœ¨ç»“æœ2ï¼Œå®ƒçš„æ‰§è¡Œåˆ™æ˜¯åœ¨ä¸‰æ¬¡äº‹ä»¶å¾ªç¯ç»“æŸåã€‚")]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("äº‹ä»¶å¾ªç¯æ˜¯jså®ç°å¼‚æ­¥çš„æ ¸å¿ƒ")])]),t._v(" "),a("li",[a("p",[t._v("æ¯è½®äº‹ä»¶å¾ªç¯åˆ†ä¸º3ä¸ªæ­¥éª¤ï¼š")]),t._v(" "),a("blockquote",[a("p",[t._v("a) æ‰§è¡Œmacrotaské˜Ÿåˆ—çš„ä¸€ä¸ªä»»åŠ¡\nb) æ‰§è¡Œå®Œå½“å‰microtaské˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡\nc) UI render")])])]),t._v(" "),a("li",[a("p",[t._v("æµè§ˆå™¨åªä¿è¯requestAnimationFrameçš„å›è°ƒåœ¨é‡ç»˜ä¹‹å‰æ‰§è¡Œï¼Œæ²¡æœ‰ç¡®å®šçš„æ—¶é—´ï¼Œä½•æ—¶é‡ç»˜ç”±æµè§ˆå™¨å†³å®š")])])]),t._v(" "),a("p",[t._v("[å‚è€ƒèµ„æ–™]")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.w3.org/TR/html5/webappapis.html#event-loops",target:"_blank",rel:"noopener noreferrer"}},[t._v("event-loops"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://ecma-international.org/ecma-262/6.0/#sec-jobs-and-job-queues",target:"_blank",rel:"noopener noreferrer"}},[t._v("sec-jobs-and-job-queues"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[t._v("Promises/A+"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tasks, microtasks, queues and schedules"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/24460769",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTMLç³»åˆ—ï¼šmacrotaskå’Œmicrotask"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("http://www.ruanyifeng.com/blog/2014/10/event-loop.html")])]),t._v(" "),a("h1",{attrs:{id:"æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶-node-jsç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶-node-jsç¯‡"}},[t._v("#")]),t._v(" æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆNode.jsç¯‡ï¼‰")]),t._v(" "),a("p",[t._v("åœ¨"),a("a",{attrs:{href:"http://lynnelv.github.io/js-event-loop-browser",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµè§ˆå™¨ç¯‡"),a("OutboundLink")],1),t._v("å·²ç»å¯¹äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œä¸€äº›ç›¸å…³çš„æ¦‚å¿µä½œäº†è¯¦ç»†ä»‹ç»ï¼Œä½†ä¸»è¦æ˜¯é’ˆå¯¹æµè§ˆå™¨ç«¯çš„ç ”ç©¶ï¼ŒNodeç¯å¢ƒæ˜¯å¦ä¹Ÿä¸€æ ·å‘¢ï¼Ÿå…ˆçœ‹ä¸€ä¸ªdemoï¼š")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("è‚‰çœ¼ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œè’½ï¼Œåœ¨æµè§ˆå™¨çš„ç»“æœå°±æ˜¯ä¸‹é¢è¿™ä¸ªäº†ï¼Œé“ç†éƒ½æ‡‚ï¼Œå°±ä¸ç´¯è¿°äº†ã€‚")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("timer1\npromise1\ntimer2\npromise2\n")])])]),a("p",[t._v("é‚£ä¹ˆNodeä¸‹æ‰§è¡Œçœ‹çœ‹ï¼Œå’¦ã€‚ã€‚ã€‚å¥‡æ€ªï¼Œè·Ÿæµè§ˆå™¨çš„è¿è¡Œç»“æœå¹¶ä¸ä¸€æ ·~")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("timer1\ntimer2\npromise1\npromise2\n")])])]),a("p",[t._v("ä¾‹å­è¯´æ˜ï¼Œæµè§ˆå™¨å’Œ Node.js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸€èµ·æ¥çœ‹ä¸ªç©¶ç«Ÿå§~")]),t._v(" "),a("h2",{attrs:{id:"node-jsçš„äº‹ä»¶å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-jsçš„äº‹ä»¶å¤„ç†"}},[t._v("#")]),t._v(" Node.jsçš„äº‹ä»¶å¤„ç†")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Node.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),a("OutboundLink")],1),t._v("é‡‡ç”¨V8ä½œä¸ºjsçš„è§£æå¼•æ“ï¼Œè€ŒI/Oå¤„ç†æ–¹é¢ä½¿ç”¨äº†è‡ªå·±è®¾è®¡çš„libuvï¼Œlibuvæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„è·¨å¹³å°æŠ½è±¡å±‚ï¼Œå°è£…äº†ä¸åŒæ“ä½œç³»ç»Ÿä¸€äº›åº•å±‚ç‰¹æ€§ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„APIï¼Œäº‹ä»¶å¾ªç¯æœºåˆ¶ä¹Ÿæ˜¯å®ƒé‡Œé¢çš„å®ç°ï¼Œ"),a("a",{attrs:{href:"https://github.com/libuv/libuv/blob/v1.x/src/unix/core.c#L348-L397",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ ¸å¿ƒæºç å‚è€ƒ"),a("OutboundLink")],1),t._v("ï¼š")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv_run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uv_loop_t")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uv_run_mode mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" ran_pending"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__loop_alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// timersé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_timers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// I/O callbacksé˜¶æ®µ")]),t._v("\n    ran_pending "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_pending")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// idleé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// prepareé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_prepare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ran_pending"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv_backend_timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pollé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__io_poll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// checké˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// close callbacksé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_closing_handles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_timers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__loop_alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_NOWAIT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("æ ¹æ®"),a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),a("OutboundLink")],1),t._v("å®˜æ–¹ä»‹ç»ï¼Œæ¯æ¬¡äº‹ä»¶å¾ªç¯éƒ½åŒ…å«äº†6ä¸ªé˜¶æ®µï¼Œå¯¹åº”åˆ° libuv æºç ä¸­çš„å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º")]),t._v(" "),a("p",[a("img",{attrs:{src:"ajsEventLoop.assets/node-libuv.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("timers é˜¶æ®µ")]),t._v("ï¼šè¿™ä¸ªé˜¶æ®µæ‰§è¡Œtimerï¼ˆ"),a("code",[t._v("setTimeout")]),t._v("ã€"),a("code",[t._v("setInterval")]),t._v("ï¼‰çš„å›è°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("I/O callbacks é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œä¸€äº›ç³»ç»Ÿè°ƒç”¨é”™è¯¯ï¼Œæ¯”å¦‚ç½‘ç»œé€šä¿¡çš„é”™è¯¯å›è°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("idle, prepare é˜¶æ®µ")]),t._v("ï¼šä»…nodeå†…éƒ¨ä½¿ç”¨")]),t._v(" "),a("li",[a("strong",[t._v("poll é˜¶æ®µ")]),t._v("ï¼šè·å–æ–°çš„I/Oäº‹ä»¶, é€‚å½“çš„æ¡ä»¶ä¸‹nodeå°†é˜»å¡åœ¨è¿™é‡Œ")]),t._v(" "),a("li",[a("strong",[t._v("check é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œ "),a("code",[t._v("setImmediate()")]),t._v(" çš„å›è°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("close callbacks é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œ "),a("code",[t._v("socket")]),t._v(" çš„ "),a("code",[t._v("close")]),t._v(" äº‹ä»¶å›è°ƒ")])]),t._v(" "),a("p",[t._v("æˆ‘ä»¬é‡ç‚¹çœ‹"),a("code",[t._v("timers")]),t._v("ã€"),a("code",[t._v("poll")]),t._v("ã€"),a("code",[t._v("check")]),t._v("è¿™3ä¸ªé˜¶æ®µå°±å¥½ï¼Œå› ä¸ºæ—¥å¸¸å¼€å‘ä¸­çš„ç»å¤§éƒ¨åˆ†å¼‚æ­¥ä»»åŠ¡éƒ½æ˜¯åœ¨è¿™3ä¸ªé˜¶æ®µå¤„ç†çš„ã€‚")]),t._v(" "),a("h3",{attrs:{id:"timers-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timers-é˜¶æ®µ"}},[t._v("#")]),t._v(" timers é˜¶æ®µ")]),t._v(" "),a("p",[t._v("timers æ˜¯äº‹ä»¶å¾ªç¯çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒNode ä¼šå»æ£€æŸ¥æœ‰æ— å·²è¿‡æœŸçš„timerï¼Œå¦‚æœæœ‰åˆ™æŠŠå®ƒçš„å›è°ƒå‹å…¥timerçš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œäº‹å®ä¸Šï¼ŒNode å¹¶ä¸èƒ½ä¿è¯timeråœ¨é¢„è®¾æ—¶é—´åˆ°äº†å°±ä¼šç«‹å³æ‰§è¡Œï¼Œå› ä¸ºNodeå¯¹timerçš„è¿‡æœŸæ£€æŸ¥ä¸ä¸€å®šé è°±ï¼Œå®ƒä¼šå—æœºå™¨ä¸Šå…¶å®ƒè¿è¡Œç¨‹åºå½±å“ï¼Œæˆ–è€…é‚£ä¸ªæ—¶é—´ç‚¹ä¸»çº¿ç¨‹ä¸ç©ºé—²ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œ"),a("code",[t._v("setTimeout()")]),t._v(" å’Œ "),a("code",[t._v("setImmediate()")]),t._v(" çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'immediate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("ä½†æ˜¯æŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªI/Oå›è°ƒé‡Œé¢ï¼Œå°±ä¸€å®šæ˜¯ "),a("code",[t._v("setImmediate()")]),t._v(" å…ˆæ‰§è¡Œï¼Œå› ä¸ºpollé˜¶æ®µåé¢å°±æ˜¯checké˜¶æ®µã€‚")]),t._v(" "),a("h3",{attrs:{id:"poll-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#poll-é˜¶æ®µ"}},[t._v("#")]),t._v(" poll é˜¶æ®µ")]),t._v(" "),a("p",[t._v("poll é˜¶æ®µä¸»è¦æœ‰2ä¸ªåŠŸèƒ½ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¤„ç† poll é˜Ÿåˆ—çš„äº‹ä»¶")]),t._v(" "),a("li",[t._v("å½“æœ‰å·²è¶…æ—¶çš„ timerï¼Œæ‰§è¡Œå®ƒçš„å›è°ƒå‡½æ•°")])]),t._v(" "),a("p",[t._v("even loopå°†åŒæ­¥æ‰§è¡Œpollé˜Ÿåˆ—é‡Œçš„å›è°ƒï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–æ‰§è¡Œçš„å›è°ƒè¾¾åˆ°ç³»ç»Ÿä¸Šé™ï¼ˆä¸Šé™å…·ä½“å¤šå°‘æœªè¯¦ï¼‰ï¼Œæ¥ä¸‹æ¥even loopä¼šå»æ£€æŸ¥æœ‰æ— é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š")]),t._v(" "),a("ol",[a("li",[t._v("è‹¥æœ‰é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v(", event loopå°†ç»“æŸpollé˜¶æ®µè¿›å…¥checké˜¶æ®µï¼Œå¹¶æ‰§è¡Œchecké˜¶æ®µçš„ä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("li",[t._v("è‹¥æ²¡æœ‰é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œevent loopå°†é˜»å¡åœ¨è¯¥é˜¶æ®µç­‰å¾…")])]),t._v(" "),a("p",[t._v("æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œæ²¡æœ‰"),a("code",[t._v("setImmediate()")]),t._v("ä¼šå¯¼è‡´event loopé˜»å¡åœ¨pollé˜¶æ®µï¼Œè¿™æ ·ä¹‹å‰è®¾ç½®çš„timerå²‚ä¸æ˜¯æ‰§è¡Œä¸äº†äº†ï¼Ÿæ‰€ä»¥å’§ï¼Œåœ¨pollé˜¶æ®µevent loopä¼šæœ‰ä¸€ä¸ªæ£€æŸ¥æœºåˆ¶ï¼Œæ£€æŸ¥timeré˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœtimeré˜Ÿåˆ—éç©ºï¼Œevent loopå°±å¼€å§‹ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ï¼Œå³é‡æ–°è¿›å…¥åˆ°timeré˜¶æ®µã€‚")]),t._v(" "),a("h3",{attrs:{id:"check-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check-é˜¶æ®µ"}},[t._v("#")]),t._v(" check é˜¶æ®µ")]),t._v(" "),a("p",[a("code",[t._v("setImmediate()")]),t._v("çš„å›è°ƒä¼šè¢«åŠ å…¥checké˜Ÿåˆ—ä¸­ï¼Œ ä»event loopçš„é˜¶æ®µå›¾å¯ä»¥çŸ¥é“ï¼Œchecké˜¶æ®µçš„æ‰§è¡Œé¡ºåºåœ¨pollé˜¶æ®µä¹‹åã€‚")]),t._v(" "),a("h2",{attrs:{id:"å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[t._v("#")]),t._v(" å°ç»“")]),t._v(" "),a("ul",[a("li",[t._v("event loop çš„æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("li",[t._v("å½“ event loop åˆ°è¾¾æŸä¸ªé˜¶æ®µæ—¶ï¼Œå°†æ‰§è¡Œè¯¥é˜¶æ®µçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œç›´åˆ°é˜Ÿåˆ—æ¸…ç©ºæˆ–æ‰§è¡Œçš„å›è°ƒè¾¾åˆ°ç³»ç»Ÿä¸Šé™åï¼Œæ‰ä¼šè½¬å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ")]),t._v(" "),a("li",[t._v("å½“æ‰€æœ‰é˜¶æ®µè¢«é¡ºåºæ‰§è¡Œä¸€æ¬¡åï¼Œç§° event loop å®Œæˆäº†ä¸€ä¸ª tick")])]),t._v(" "),a("p",[t._v("è®²å¾—å¥½æœ‰é“ç†ï¼Œå¯æ˜¯æ²¡æœ‰demoæˆ‘è¿˜æ˜¯ç†è§£ä¸å…¨å•Šï¼Œæ†‹æ€¥ï¼Œnowï¼")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'readFile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'immediate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("æ‰§è¡Œç»“æœåº”è¯¥éƒ½æ²¡æœ‰ç–‘é—®äº†")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("readFile\nimmediate\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),t._v("\n")])])]),a("h2",{attrs:{id:"node-js-ä¸æµè§ˆå™¨çš„-event-loop-å·®å¼‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js-ä¸æµè§ˆå™¨çš„-event-loop-å·®å¼‚"}},[t._v("#")]),t._v(" Node.js ä¸æµè§ˆå™¨çš„ Event Loop å·®å¼‚")]),t._v(" "),a("p",[t._v("å›é¡¾ä¸Šä¸€ç¯‡ï¼Œæµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œ"),a("code",[t._v("microtask")]),t._v("çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯æ¯ä¸ª"),a("code",[t._v("macrotask")]),t._v("æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"ajsEventLoop.assets/ma(i)crotask.png",alt:"æµè§ˆå™¨ç«¯"}})]),t._v(" "),a("p",[t._v("è€Œåœ¨Node.jsä¸­ï¼Œ"),a("code",[t._v("microtask")]),t._v("ä¼šåœ¨äº‹ä»¶å¾ªç¯çš„å„ä¸ªé˜¶æ®µä¹‹é—´æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šå»æ‰§è¡Œ"),a("code",[t._v("microtask")]),t._v("é˜Ÿåˆ—çš„ä»»åŠ¡ã€‚"),a("img",{attrs:{src:"ajsEventLoop.assets/ma(i)crotask-in-node.png",alt:"Node.jsç«¯"}})]),t._v(" "),a("h2",{attrs:{id:"demoå›é¡¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demoå›é¡¾"}},[t._v("#")]),t._v(" demoå›é¡¾")]),t._v(" "),a("p",[t._v("å›é¡¾æ–‡ç« æœ€å¼€å§‹çš„demoï¼Œå…¨å±€è„šæœ¬ï¼ˆmain()ï¼‰æ‰§è¡Œï¼Œå°†2ä¸ªtimerä¾æ¬¡æ”¾å…¥timeré˜Ÿåˆ—ï¼Œmain()æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨æ ˆç©ºé—²ï¼Œä»»åŠ¡é˜Ÿåˆ—å¼€å§‹æ‰§è¡Œï¼›")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/node-excute-animate.gif",alt:"Node.jsä¸‹çš„å¤„ç†è¿‡ç¨‹"}})]),t._v(" "),a("p",[t._v("é¦–å…ˆè¿›å…¥timersé˜¶æ®µï¼Œæ‰§è¡Œtimer1çš„å›è°ƒå‡½æ•°ï¼Œæ‰“å°"),a("code",[t._v("timer1")]),t._v("ï¼Œå¹¶å°†promise1.thenå›è°ƒæ”¾å…¥microtaské˜Ÿåˆ—ï¼ŒåŒæ ·çš„æ­¥éª¤æ‰§è¡Œtimer2ï¼Œæ‰“å°"),a("code",[t._v("timer2")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è‡³æ­¤ï¼Œtimeré˜¶æ®µæ‰§è¡Œç»“æŸï¼Œevent loopè¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µä¹‹å‰ï¼Œæ‰§è¡Œ"),a("code",[t._v("microtask")]),t._v("é˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡ï¼Œä¾æ¬¡æ‰“å°"),a("code",[t._v("promise1")]),t._v("ã€"),a("code",[t._v("promise2")]),t._v("ã€‚")]),t._v(" "),a("p",[t._v("å¯¹æ¯”æµè§ˆå™¨ç«¯çš„å¤„ç†è¿‡ç¨‹ï¼š"),a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/browser-excute-animate.gif",alt:"Browserä¸‹çš„å¤„ç†è¿‡ç¨‹"}})]),t._v(" "),a("h3",{attrs:{id:"process-nexttick-vs-setimmediate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#process-nexttick-vs-setimmediate"}},[t._v("#")]),t._v(" process.nextTick() VS setImmediate()")]),t._v(" "),a("blockquote",[a("p",[t._v("In essence, the names should be swapped. process.nextTick() fires more immediately than setImmediate()")])]),t._v(" "),a("p",[t._v("æ¥è‡ªå®˜æ–¹æ–‡æ¡£æœ‰æ„æ€çš„ä¸€å¥è¯ï¼Œä»è¯­ä¹‰è§’åº¦çœ‹ï¼Œ"),a("code",[t._v("setImmediate()")]),t._v(" åº”è¯¥æ¯” "),a("code",[t._v("process.nextTick()")]),t._v(" å…ˆæ‰§è¡Œæ‰å¯¹ï¼Œè€Œäº‹å®ç›¸åï¼Œå‘½åæ˜¯å†å²åŸå› ä¹Ÿå¾ˆéš¾å†å˜ã€‚")]),t._v(" "),a("p",[a("code",[t._v("process.nextTick()")]),t._v(" ä¼šåœ¨å„ä¸ªäº‹ä»¶é˜¶æ®µä¹‹é—´æ‰§è¡Œï¼Œä¸€æ—¦æ‰§è¡Œï¼Œè¦ç›´åˆ°nextTické˜Ÿåˆ—è¢«æ¸…ç©ºï¼Œæ‰ä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶é˜¶æ®µï¼Œæ‰€ä»¥å¦‚æœé€’å½’è°ƒç”¨ "),a("code",[t._v("process.nextTick()")]),t._v("ï¼Œä¼šå¯¼è‡´å‡ºç°I/O starvingï¼ˆé¥¥é¥¿ï¼‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢ä¾‹å­çš„readFileå·²ç»å®Œæˆï¼Œä½†å®ƒçš„å›è°ƒä¸€ç›´æ— æ³•æ‰§è¡Œï¼š")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" starttime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" endtime\n\nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  endtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'finish reading time: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" starttime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("nextTick ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log(`setImmediate ${index}`)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setImmediate(handler)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("code",[t._v("process.nextTick()")]),t._v("çš„è¿è¡Œç»“æœï¼š")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("nextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("999")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nfinish reading time: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("170")]),t._v("\n")])])]),a("p",[t._v("æ›¿æ¢æˆ"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œè¿è¡Œç»“æœï¼š")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("setImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\nfinish reading time: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("999")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n")])])]),a("p",[t._v("è¿™æ˜¯å› ä¸ºåµŒå¥—è°ƒç”¨çš„ "),a("code",[t._v("setImmediate()")]),t._v(" å›è°ƒï¼Œè¢«æ’åˆ°äº†ä¸‹ä¸€æ¬¡event loopæ‰æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°é˜»å¡ã€‚")]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-2"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Node.js çš„äº‹ä»¶å¾ªç¯åˆ†ä¸º6ä¸ªé˜¶æ®µ")])]),t._v(" "),a("li",[a("p",[t._v("æµè§ˆå™¨å’ŒNode ç¯å¢ƒä¸‹ï¼Œ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("microtask\n")])])]),a("p",[t._v("ä»»åŠ¡é˜Ÿåˆ—çš„æ‰§è¡Œæ—¶æœºä¸åŒ")]),t._v(" "),a("ul",[a("li",[t._v("Node.jsä¸­ï¼Œ"),a("code",[t._v("microtask")]),t._v(" åœ¨äº‹ä»¶å¾ªç¯çš„å„ä¸ªé˜¶æ®µä¹‹é—´æ‰§è¡Œ")]),t._v(" "),a("li",[t._v("æµè§ˆå™¨ç«¯ï¼Œ"),a("code",[t._v("microtask")]),t._v(" åœ¨äº‹ä»¶å¾ªç¯çš„ "),a("code",[t._v("macrotask")]),t._v(" æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ")])])]),t._v(" "),a("li",[a("p",[t._v("é€’å½’çš„è°ƒç”¨"),a("code",[t._v("process.nextTick()")]),t._v("ä¼šå¯¼è‡´I/O starvingï¼Œå®˜æ–¹æ¨èä½¿ç”¨"),a("code",[t._v("setImmediate()")])])])]),t._v(" "),a("p",[t._v("[å‚è€ƒèµ„æ–™]")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/",target:"_blank",rel:"noopener noreferrer"}},[t._v("event-loop-timers-and-nexttick"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://cnodejs.org/topic/57d68794cb6f605d360105bf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js Event Loop çš„ç†è§£ Timersï¼Œprocess.nextTick()"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/libuv/libuv/blob/v1.x/src/unix/core.c",target:"_blank",rel:"noopener noreferrer"}},[t._v("libuv/core.c"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/nodejs/node/blob/master/lib/internal/process/next_tick.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs/next_tick.js"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://lynnelv.github.io/js-event-loop-browser",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ·±å…¥ç†è§£jsäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆæµè§ˆå™¨ç¯‡ï¼‰ - lynnelv's blog"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);