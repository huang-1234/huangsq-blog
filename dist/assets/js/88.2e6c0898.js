(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{600:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"js-äº‹ä»¶å¾ªçŽ¯-event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-äº‹ä»¶å¾ªçŽ¯-event-loop"}},[t._v("#")]),t._v(" JS äº‹ä»¶å¾ªçŽ¯(Event Loop)")]),t._v(" "),a("h2",{attrs:{id:"æ¦‚å¿µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚å¿µ"}},[t._v("#")]),t._v(" æ¦‚å¿µ")]),t._v(" "),a("p",[t._v("JavaScript æœ‰ä¸€ä¸ªåŸºäºŽäº‹ä»¶å¾ªçŽ¯çš„å¹¶å‘æ¨¡åž‹ï¼Œäº‹ä»¶å¾ªçŽ¯è´Ÿè´£æ‰§è¡Œä»£ç ã€æ”¶é›†å’Œå¤„ç†äº‹ä»¶ä»¥åŠæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å­ä»»åŠ¡ã€‚è¿™ä¸ªæ¨¡åž‹ä¸Žå…¶å®ƒè¯­è¨€ä¸­çš„æ¨¡åž‹æˆªç„¶ä¸åŒï¼Œæ¯”å¦‚ C å’Œ Javaã€‚"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop",target:"_blank",rel:"noopener noreferrer"}},[t._v("ï¼ˆæ‘˜è‡ª MDNï¼‰"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("ç®€å•åœ°è¯´ï¼Œå¯¹äºŽ JS è¿è¡Œä¸­çš„ä»»åŠ¡ï¼ŒJS æœ‰ä¸€å¥—å¤„ç†æ”¶é›†ï¼ŒæŽ’é˜Ÿï¼Œæ‰§è¡Œçš„ç‰¹æ®Šæœºåˆ¶ï¼Œæˆ‘ä»¬æŠŠè¿™å¥—å¤„ç†æœºåˆ¶ç§°ä¸ºäº‹ä»¶å¾ªçŽ¯ï¼ˆEvent Loopï¼‰ã€‚")]),t._v(" "),a("p",[t._v("ä¸ºäº†æ›´æ·±åˆ»çš„ç†è§£äº‹ä»¶å¾ªçŽ¯ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªç›¸å…³æ¦‚å¿µ")]),t._v(" "),a("h4",{attrs:{id:"å•çº¿ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å•çº¿ç¨‹"}},[t._v("#")]),t._v(" å•çº¿ç¨‹")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬éƒ½çŸ¥é“ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ")]),t._v(" "),a("p",[t._v("JS å•çº¿ç¨‹æŒ‡çš„æ˜¯ javascript å¼•æ“Žï¼ˆå¦‚ V8ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("æœ‰äººæˆ–è®¸ä¼šé—®ï¼Œå¼‚æ­¥ä»»åŠ¡ ajax éš¾é“ä¸æ˜¯å¯ä»¥å’Œ JS ä»£ç åŒæ—¶æ‰§è¡Œä¹ˆï¼Ÿ")]),t._v(" "),a("p",[t._v("ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¿™å’Œ JS å•çº¿ç¨‹å¹¶ä¸å†²çªï¼Œå‰é¢è¯´è¿‡ javascript å¼•æ“Žï¼ˆå¦‚ V8ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚ä½†è¿™å¹¶ä¸æ˜¯è¯´æµè§ˆå™¨åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä»¶äº‹æƒ…ï¼Œå®žé™…ä¸Š ajax ç­‰å¼‚æ­¥ä»»åŠ¡ä¸æ˜¯åœ¨ JS å¼•æ“Žä¸Šè¿è¡Œçš„ï¼Œajax åœ¨æµè§ˆå™¨å¤„ç†ç½‘ç»œçš„æ¨¡å—ä¸­æ‰§è¡Œï¼Œæ­¤æ—¶ä¸ä¼šå½±å“åˆ° JS å¼•æ“Žçš„ä»»åŠ¡å¤„ç†ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¡¨ç¤ºæ­¤æ—¶å¤„ç†çš„åªæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œ\næˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªæ­£åœ¨å¤„ç†çš„å‡½æ•°ï¼ŒåŒæ—¶æ‹¥æœ‰å¤šä¸ªæ‰§è¡ŒçŽ¯å¢ƒï¼ŒåŽé¢ä¼šæœ‰åˆ†æžã€‚\n")])])]),a("h3",{attrs:{id:"æ‰§è¡ŒçŽ¯å¢ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‰§è¡ŒçŽ¯å¢ƒ"}},[t._v("#")]),t._v(" æ‰§è¡ŒçŽ¯å¢ƒ")]),t._v(" "),a("p",[t._v("å…³äºŽæ‰§è¡ŒçŽ¯å¢ƒå¯ä»¥å‚è€ƒ")]),t._v(" "),a("p",[t._v("æ‰§è¡ŒçŽ¯å¢ƒæ˜¯ JS ä»£ç è¯­å¥æ‰§è¡Œçš„çŽ¯å¢ƒï¼ŒåŒ…æ‹¬å…¨å±€æ‰§è¡ŒçŽ¯å¢ƒå’Œå‡½æ•°æ‰§è¡ŒçŽ¯å¢ƒã€‚")]),t._v(" "),a("ul",[a("li",[t._v("å…¨å±€æ‰§è¡ŒçŽ¯å¢ƒï¼šå…¨å±€çŽ¯å¢ƒæ˜¯æœ€å¤–å›´çš„ä¸€ä¸ªæ‰§è¡ŒçŽ¯å¢ƒï¼Œæ ¹æ® ECMAScript å®žçŽ°æ‰€åœ¨çš„å®¿ä¸»çŽ¯å¢ƒä¸åŒï¼Œè¡¨ç¤ºæ‰§è¡ŒçŽ¯å¢ƒçš„å¯¹è±¡ä¹Ÿä¸ä¸€æ ·ï¼Œåœ¨ web ä¸­ï¼Œå…¨å±€æ‰§è¡ŒçŽ¯å¢ƒè¢«è®¤ä¸ºæ˜¯ window å¯¹è±¡ã€‚")]),t._v(" "),a("li",[t._v("å‡½æ•°æ‰§è¡ŒçŽ¯å¢ƒï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡ŒçŽ¯å¢ƒã€‚")])]),t._v(" "),a("p",[t._v("å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œç›¸åº”çš„ä¼šå¯¹åº”ä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„æ‰§è¡ŒçŽ¯å¢ƒæ ˆï¼Œè¿™ä¸ªæ‰§è¡ŒçŽ¯å¢ƒæ ˆåŒ…æ‹¬äº†ä¸åŒçš„æ‰§è¡ŒçŽ¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªåŽè¿›å…ˆå‡ºçš„ç»“æž„ã€‚")]),t._v(" "),a("p",[t._v("ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹æ‰§è¡ŒçŽ¯å¢ƒæ ˆçš„åŠ¨æ€å˜åŒ–")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤æ—¶")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fn1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"å˜é‡å¯¹è±¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡å¯¹è±¡"}},[t._v("#")]),t._v(" å˜é‡å¯¹è±¡")]),t._v(" "),a("p",[t._v("æ¯ä¸ªæ‰§è¡ŒçŽ¯å¢ƒéƒ½æœ‰ä¸€ä¸ªå˜é‡å¯¹è±¡ä¸Žä¹‹å…³è”ï¼ˆä¸€ä¸€å¯¹åº”ï¼‰ï¼Œå˜é‡å¯¹è±¡åŒ…å«äº†æ‰§è¡ŒçŽ¯å¢ƒä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡åŠå‡½æ•°ã€‚ï¼ˆåœ¨æ­¤å¤„å¯ä»¥æ€è€ƒä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬æå€¡å°½é‡å°‘åˆ›å»ºå…¨å±€å˜é‡ï¼Œç­”æ¡ˆå°±æ˜¯å› ä¸ºå…¨å±€çŽ¯å¢ƒå¯¹åº”çš„å˜é‡å¯¹è±¡ä¸€ç›´ä¼šå­˜åœ¨å†…å­˜ä¸­ã€‚ï¼‰")]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¾ªçŽ¯æœºåˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªçŽ¯æœºåˆ¶"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªçŽ¯æœºåˆ¶")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬å…ˆçœ‹çœ‹ MDN ä¸Šçš„ä¸€å¼ å›¾ç‰‡\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201444501-1827901668.png"),alt:"mixureSecure"}})]),t._v(" "),a("p",[t._v("ä¸Šé¢è¿™å¼ å›¾å¾ˆå¥½åœ°å±•ç¤ºäº† JS ä¸­çš„äº‹ä»¶å¾ªçŽ¯æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ä¸­ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒStackï¼ŒHeapï¼ŒQueueï¼Œä¸‹é¢é€ä¸ªåˆ†æžã€‚")]),t._v(" "),a("ul",[a("li",[t._v("Stack è¡¨ç¤ºè®¡ç®—æœºçš„æ ˆç»“æž„ï¼Œæ­¤å¤„ Stack åŒºåŸŸè¡¨ç¤ºçš„æ˜¯å½“å‰ JS çº¿ç¨‹æ­£åœ¨å¤„ç†çš„ä»»åŠ¡(ä¸€ä¸ªä»»åŠ¡)ã€‚ç»“åˆæ‰§è¡ŒçŽ¯å¢ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å…¶å®žå¯ä»¥æŠŠè¿™äº› Frame çš„ç»„åˆå½“ä½œå½“å‰çš„æ‰§è¡ŒçŽ¯å¢ƒæ ˆã€‚ä¸€ä¸ª Frame è¡¨ç¤ºä¸€ä¸ªæ‰§è¡ŒçŽ¯å¢ƒã€‚è¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸€ä¸ªä»»åŠ¡ä¸‹å…¶å®žå¯ä»¥åŒ…å«å¤šä¸ªç›¸å…³å‡½æ•°ã€‚")]),t._v(" "),a("li",[t._v("Heap ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºè®¡ç®—æœºå†…å­˜ï¼Œæ­¤å¤„ Heap è¡¨ç¤ºå½“å‰ä»»åŠ¡ä¸‹ç›¸å…³çš„æ•°æ®ï¼Œç»“åˆä¸Šé¢å˜é‡å¯¹è±¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…¶ä¸­çš„ Object æ ‡ç­¾å½“ä½œæ˜¯æ‰§è¡ŒçŽ¯å¢ƒå¯¹åº”çš„å˜é‡å¯¹è±¡ã€‚ä¸€ä¸ªæ‰§è¡ŒçŽ¯å¢ƒæŽ¨å…¥æ‰§è¡ŒçŽ¯å¢ƒæ ˆæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå˜é‡å¯¹è±¡æ”¾å…¥ Heap åŒºåŸŸï¼Œå½“æ‰§è¡ŒçŽ¯å¢ƒæ ˆæŽ¨å‡ºè¿™ä¸ªæ‰§è¡ŒçŽ¯å¢ƒæ—¶ï¼Œå…¶ç›¸å¯¹åº”çš„å˜é‡å¯¹è±¡åœ¨ Heap ç§»é™¤å¹¶é”€æ¯ã€‚å¦‚æžœå†æ·±å…¥ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œé‡Œé¢ Object çš„é›†åˆå…¶å®žå°±æ˜¯æˆ‘ä»¬çš„ä½œç”¨åŸŸé“¾çš„å˜é‡å¯¹è±¡é›†åˆã€‚")]),t._v(" "),a("li",[t._v("Queue åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºé˜Ÿåˆ—ï¼Œæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æž„ã€‚æ­¤å¤„ Queue åŒºè¡¨ç¤ºäº†å½“å‰æ­£åœ¨æŽ’é˜Ÿçš„ä»»åŠ¡é›†åˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä»»åŠ¡é˜Ÿåˆ—ã€‚ä¸€ä¸ª Message è¡¨ç¤ºä¸€ä¸ªå¾…æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒä»¬æ˜¯æŒ‰é¡ºåºæŽ’é˜Ÿçš„ã€‚")])]),t._v(" "),a("p",[t._v("åˆ†æžå®Œå›¾ç‰‡çš„ä¸åŒåŒºåŸŸï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°åˆ†æžå‡ºè¿™å¼ å›¾ä¸­é˜é‡Šçš„äº‹ä»¶çŽ¯å¢ƒæœºåˆ¶äº†")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼ŒæœŸé—´å¯èƒ½åˆ›å»ºå¤šä¸ªå‡½æ•°æ‰§è¡ŒçŽ¯å¢ƒï¼Œå¯¹åº” Frameã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œéšæ—¶æ‰§è¡ŒçŽ¯å¢ƒæ ˆçš„åŠ¨æ€å˜åŒ–ï¼Œç›¸å¯¹åº”çš„å˜é‡å¯¹è±¡ä¸æ–­åˆ›å»ºé”€æ¯ï¼Œå¯¹åº” Objectã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" å¼‚æ­¥ä»»åŠ¡ ajax "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("O")]),t._v(" ç­‰å¾—åˆ°ç»“æžœæ—¶ï¼Œä¼šå°†å…¶å›žè°ƒä½œä¸ºä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼ŒæŽ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" å½“ "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ— Queueï¼Œå¹¶å°†é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ° "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JS")]),t._v(" çº¿ç¨‹ä¸­å¹¶æ‰§è¡Œã€‚\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.")]),t._v(" å¾ªçŽ¯ "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" æ­¥ï¼Œå¼‚æ­¥ä»»åŠ¡å®ŒæˆåŽä¸æ–­åœ°å¾€ä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œçº¿ç¨‹ç©ºé—²æ—¶ä»Žä»»åŠ¡åˆ—è¡¨è¯»å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚\n")])])]),a("h3",{attrs:{id:"äº‹ä»¶å¾ªçŽ¯ä¸‹çš„å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªçŽ¯ä¸‹çš„å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªçŽ¯ä¸‹çš„å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡")]),t._v(" "),a("p",[t._v("é€šå¸¸æˆ‘ä»¬æŠŠå¼‚æ­¥ä»»åŠ¡åˆ†ä¸ºå®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡ï¼Œå®ƒä»¬çš„åŒºåˆ†åœ¨äºŽï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å®ä»»åŠ¡ï¼ˆmacro-taskï¼‰ï¼šä¸€èˆ¬æ˜¯ JS å¼•æ“Žå’Œå®¿ä¸»çŽ¯å¢ƒå‘ç”Ÿé€šä¿¡äº§ç”Ÿçš„å›žè°ƒä»»åŠ¡ï¼Œæ¯”å¦‚ setTimeoutï¼ŒsetInterval æ˜¯æµè§ˆå™¨è¿›è¡Œè®¡æ—¶çš„ï¼Œå…¶ä¸­å›žè°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶é—´éœ€è¦æµè§ˆå™¨é€šçŸ¥åˆ° JS å¼•æ“Žï¼Œç½‘ç»œæ¨¡å—, I/O å¤„ç†çš„é€šä¿¡å›žè°ƒä¹Ÿæ˜¯ã€‚åŒ…å«æœ‰ setTimeoutï¼ŒsetIntervalï¼ŒDOM äº‹ä»¶å›žè°ƒï¼Œajax è¯·æ±‚ç»“æŸåŽçš„å›žè°ƒï¼Œæ•´ä½“ script ä»£ç ï¼ŒsetImmediateã€‚")]),t._v(" "),a("li",[t._v("å¾®ä»»åŠ¡ï¼ˆmicro-taskï¼‰ï¼šä¸€èˆ¬æ˜¯å®ä»»åŠ¡åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶äº§ç”Ÿçš„å›žè°ƒï¼Œå¦‚ Promiseï¼Œprocess.nextTickï¼ŒObject.observe(å·²åºŸå¼ƒ)ï¼Œ MutationObserverï¼ˆDOM ç›‘å¬ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯ JS å¼•æ“Žè‡ªèº«å¯ä»¥ç›‘å¬åˆ°å›žè°ƒã€‚")])]),t._v(" "),a("p",[t._v("ä¸Šé¢æˆ‘ä»¬äº†è§£äº†å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡çš„åˆ†ç±»ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å°†å…¶åˆ†ä¸ºå®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå…¶æ·»åŠ åˆ°äº‹ä»¶å¾ªçŽ¯ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—çš„æœºåˆ¶ä¸åŒã€‚")]),t._v(" "),a("p",[t._v("åœ¨äº‹ä»¶å¾ªçŽ¯ä¸­ï¼Œä»»åŠ¡ä¸€èˆ¬éƒ½æ˜¯ç”±å®ä»»åŠ¡å¼€å§‹æ‰§è¡Œçš„ï¼ˆJS ä»£ç çš„åŠ è½½æ‰§è¡Œï¼‰ï¼Œåœ¨å®ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ–°çš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œè¿™æ—¶å€™å®ä»»åŠ¡ï¼ˆå¦‚ ajax å›žè°ƒï¼‰ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…äº‹ä»¶å¾ªçŽ¯æœºåˆ¶æ‰§è¡Œï¼Œè€Œå¾®ä»»åŠ¡åˆ™ä¼šè¢«æ·»åŠ åˆ°å½“å‰ä»»åŠ¡é˜Ÿåˆ—çš„å‰ç«¯ï¼Œä¹Ÿæ˜¯ç­‰å¾…äº‹ä»¶å¾ªçŽ¯æœºåˆ¶çš„æ‰§è¡Œã€‚")]),t._v(" "),a("p",[t._v("å…¶ä¸­ç›¸åŒç±»åž‹çš„å®ä»»åŠ¡æˆ–å¾®ä»»åŠ¡ä¼šæŒ‰ç…§å›žè°ƒçš„å…ˆåŽé¡ºåºè¿›è¡ŒæŽ’åºï¼Œè€Œä¸åŒä»»åŠ¡ç±»åž‹çš„ä»»åŠ¡ä¼šæœ‰ä¸€å®šçš„ä¼˜å…ˆçº§ï¼ŒæŒ‰ç…§ä¸åŒç±»åž‹ä»»åŠ¡åŒºåˆ†")]),t._v(" "),a("p",[t._v("å®ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä¸»ä»£ç å— > setImmediate > MessageChannel > setTimeout / setInterval")]),t._v(" "),a("p",[t._v("å¾®ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œprocess.nextTick > Promise > MutationObserver\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201508564-925237420.png"),alt:"mixureSecure"}})]),t._v(" "),a("p",[t._v("ä¸¾ä¸ª ðŸŒ°")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬æ¥åˆ†æžä¸‹é¢è¿™æ®µä»£ç çš„æ‰“å°é¡ºåº")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setTimeout1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setTimeout2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æˆ‘ä»¬å‡è®¾è¿™æ®µä»£ç æ­£åœ¨ JS çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆscript ä»£ç å±žäºŽå®ä»»åŠ¡ï¼‰ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™äº§ç”Ÿäº†ä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼ŒsetTimeout å’Œ Promiseã€‚å…¶ä¸­ setTimeout ä¸ºå®ä»»åŠ¡ï¼ŒPromise å±žäºŽå¾®ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("æ ¹æ®ä¸Šé¢çš„å®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡çš„åœ¨ä»»åŠ¡é˜Ÿåˆ—çš„æ·»åŠ æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—å°†å¦‚ä¸‹æ‰€ç¤º\n"),a("img",{attrs:{src:t.$withBase("/images/Browser/jsEventLoop.assets/1027993-20200517201526461-715634913.png"),alt:"mixureSecure"}}),t._v("\nåˆ†æžå‡ºäº†ä»»åŠ¡é˜Ÿåˆ—åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾å¾—åˆ°æ‰“å°é¡ºåºäº†")]),t._v(" "),a("p",[t._v("é¦–å…ˆæ‰§è¡Œå®ä»»åŠ¡ï¼ŒæŒ‰ç…§ä»Žä¸Šè‡³ä¸‹çš„æ‰§è¡Œé¡ºåºä¾æ¬¡æ‰“å° 4 5 7")]),t._v(" "),a("p",[t._v("æŽ¥ç€æŒ‰ç…§ä»»åŠ¡é˜Ÿåˆ—çš„å…ˆåŽé¡ºåºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œä¾æ¬¡æ‰“å° 6 8 1 2 3")]),t._v(" "),a("h2",{attrs:{id:"æ·±å…¥ç†è§£-js-äº‹ä»¶å¾ªçŽ¯æœºåˆ¶-æµè§ˆå™¨ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£-js-äº‹ä»¶å¾ªçŽ¯æœºåˆ¶-æµè§ˆå™¨ç¯‡"}},[t._v("#")]),t._v(" æ·±å…¥ç†è§£ js äº‹ä»¶å¾ªçŽ¯æœºåˆ¶ï¼ˆæµè§ˆå™¨ç¯‡ï¼‰")]),t._v(" "),a("h3",{attrs:{id:"æŠ›åœ¨å‰é¢çš„é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŠ›åœ¨å‰é¢çš„é—®é¢˜"}},[t._v("#")]),t._v(" æŠ›åœ¨å‰é¢çš„é—®é¢˜ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å•çº¿ç¨‹å¦‚ä½•åšåˆ°å¼‚æ­¥")]),t._v(" "),a("li",[t._v("äº‹ä»¶å¾ªçŽ¯çš„è¿‡ç¨‹æ˜¯æ€Žæ ·çš„")]),t._v(" "),a("li",[a("code",[t._v("macrotask")]),t._v(" å’Œ "),a("code",[t._v("microtask")]),t._v(" æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä½•åŒºåˆ«")])]),t._v(" "),a("h3",{attrs:{id:"å•çº¿ç¨‹å’Œå¼‚æ­¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å•çº¿ç¨‹å’Œå¼‚æ­¥"}},[t._v("#")]),t._v(" å•çº¿ç¨‹å’Œå¼‚æ­¥")]),t._v(" "),a("p",[t._v("æåˆ° jsï¼Œå°±ä¼šæƒ³åˆ°"),a("strong",[t._v("å•çº¿ç¨‹")]),t._v("ï¼Œ"),a("strong",[t._v("å¼‚æ­¥")]),t._v("ï¼Œé‚£ä¹ˆå•çº¿ç¨‹æ˜¯å¦‚ä½•åšåˆ°å¼‚æ­¥çš„å‘¢ï¼Ÿæ¦‚å¿µå…ˆè¡Œï¼Œå…ˆè¦äº†è§£ä¸‹å•çº¿ç¨‹å’Œå¼‚æ­¥ä¹‹é—´çš„å…³ç³»ã€‚")]),t._v(" "),a("p",[t._v("js çš„ä»»åŠ¡åˆ†ä¸º "),a("em",[t._v("åŒæ­¥")]),t._v(" å’Œ "),a("em",[t._v("å¼‚æ­¥")]),t._v(" ä¸¤ç§ï¼Œå®ƒä»¬çš„å¤„ç†æ–¹å¼ä¹Ÿä¸åŒï¼Œ"),a("strong",[t._v("åŒæ­¥ä»»åŠ¡")]),t._v("æ˜¯ç›´æŽ¥åœ¨ä¸»çº¿ç¨‹ä¸ŠæŽ’é˜Ÿæ‰§è¡Œï¼Œ"),a("strong",[t._v("å¼‚æ­¥ä»»åŠ¡")]),t._v("åˆ™ä¼šè¢«æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè‹¥æœ‰å¤šä¸ªä»»åŠ¡ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰åˆ™è¦åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æŽ’é˜Ÿç­‰å¾…ï¼Œä»»åŠ¡é˜Ÿåˆ—ç±»ä¼¼ä¸€ä¸ªç¼“å†²åŒºï¼Œä»»åŠ¡ä¸‹ä¸€æ­¥ä¼šè¢«ç§»åˆ°"),a("strong",[t._v("è°ƒç”¨æ ˆ")]),t._v("ï¼ˆcall stackï¼‰ï¼Œç„¶åŽä¸»çº¿ç¨‹æ‰§è¡Œè°ƒç”¨æ ˆçš„ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("å•çº¿ç¨‹æ˜¯æŒ‡ js å¼•æ“Žä¸­è´Ÿè´£è§£æžæ‰§è¡Œ js ä»£ç çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼ˆ"),a("strong",[t._v("ä¸»çº¿ç¨‹")]),t._v("ï¼‰ï¼Œå³æ¯æ¬¡åªèƒ½åšä¸€ä»¶äº‹ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ª ajax è¯·æ±‚ï¼Œä¸»çº¿ç¨‹åœ¨ç­‰å¾…å®ƒå“åº”çš„åŒæ—¶æ˜¯ä¼šåŽ»åšå…¶å®ƒäº‹çš„ï¼Œæµè§ˆå™¨å…ˆåœ¨äº‹ä»¶è¡¨æ³¨å†Œ ajax çš„å›žè°ƒå‡½æ•°ï¼Œå“åº”å›žæ¥åŽå›žè°ƒå‡½æ•°è¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œä¸ä¼šé€ æˆçº¿ç¨‹é˜»å¡žï¼Œæ‰€ä»¥è¯´ js å¤„ç† ajax è¯·æ±‚çš„æ–¹å¼æ˜¯å¼‚æ­¥çš„ã€‚")]),t._v(" "),a("p",[t._v("æ€»è€Œè¨€ä¹‹ï¼Œæ£€æŸ¥è°ƒç”¨æ ˆæ˜¯å¦ä¸ºç©ºï¼Œä»¥åŠç¡®å®šæŠŠå“ªä¸ª task åŠ å…¥è°ƒç”¨æ ˆçš„è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯"),a("strong",[t._v("äº‹ä»¶å¾ªçŽ¯")]),t._v("ï¼Œè€Œ"),a("strong",[t._v("js å®žçŽ°å¼‚æ­¥çš„æ ¸å¿ƒå°±æ˜¯äº‹ä»¶å¾ªçŽ¯")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—"}},[t._v("#")]),t._v(" è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("p",[t._v("é¡¾åæ€ä¹‰ï¼Œè°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªæ ˆç»“æž„ï¼Œå‡½æ•°è°ƒç”¨ä¼šå½¢æˆä¸€ä¸ªæ ˆå¸§ï¼Œå¸§ä¸­åŒ…å«äº†å½“å‰æ‰§è¡Œå‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå‡½æ•°æ‰§è¡Œå®ŒåŽï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»Žæ ˆä¸­å¼¹å‡ºã€‚")]),t._v(" "),a("p",[t._v("ä¸‹å›¾å°±æ˜¯è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—çš„å…³ç³»å›¾")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/callstack.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¾ªçŽ¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¾ªçŽ¯"}},[t._v("#")]),t._v(" äº‹ä»¶å¾ªçŽ¯")]),t._v(" "),a("p",[t._v("å…³äºŽäº‹ä»¶å¾ªçŽ¯ï¼Œ"),a("a",{attrs:{href:"https://www.w3.org/TR/html5/webappapis.html#event-loop",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTML è§„èŒƒ"),a("OutboundLink")],1),t._v("çš„ä»‹ç»")]),t._v(" "),a("blockquote",[a("p",[t._v("There must be at least one event loop per user agent, and at most one event loop per unit of related similar-origin browsing contexts.\nAn event loop has one or more task queues.\nEach task is defined as coming from a specific task source.")])]),t._v(" "),a("p",[t._v("ä»Žè§„èŒƒç†è§£ï¼Œæµè§ˆå™¨è‡³å°‘æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯ï¼Œä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆmacrotaskï¼‰ï¼Œæ¯ä¸ªå¤–ä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„åˆ†ç»„ï¼Œæµè§ˆå™¨ä¼šä¸ºä¸åŒçš„ä»»åŠ¡ç»„è®¾ç½®ä¼˜å…ˆçº§ã€‚")]),t._v(" "),a("h3",{attrs:{id:"macrotask-microtask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#macrotask-microtask"}},[t._v("#")]),t._v(" macrotask & microtask")]),t._v(" "),a("p",[t._v("è§„èŒƒæœ‰æåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼Œä½†æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼ŒæŸ¥é˜…ä¸€äº›èµ„æ–™å¤§æ¦‚å¯æ€»ç»“å¦‚ä¸‹ï¼š")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("macrotask")]),t._v("ï¼šåŒ…å«æ‰§è¡Œæ•´ä½“çš„ js ä»£ç ï¼Œäº‹ä»¶å›žè°ƒï¼ŒXHR å›žè°ƒï¼Œå®šæ—¶å™¨ï¼ˆsetTimeout/setInterval/setImmediateï¼‰ï¼ŒIO æ“ä½œï¼ŒUI render")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("microtask")]),t._v("ï¼šæ›´æ–°åº”ç”¨ç¨‹åºçŠ¶æ€çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ promise å›žè°ƒï¼ŒMutationObserverï¼Œprocess.nextTickï¼ŒObject.observe")])]),t._v(" "),a("p",[t._v("å…¶ä¸­"),a("code",[t._v("setImmediate")]),t._v("å’Œ"),a("code",[t._v("process.nextTick")]),t._v("æ˜¯ nodejs çš„å®žçŽ°ï¼Œåœ¨"),a("a",{attrs:{href:"https://huang-1234.github.io/BrowserCore/Event/ajsEventLoop.html#node-js%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs ç¯‡"),a("OutboundLink")],1),t._v("ä¼šè¯¦ç»†ä»‹ç»ã€‚")]),t._v(" "),a("h3",{attrs:{id:"äº‹ä»¶å¤„ç†è¿‡ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å¤„ç†è¿‡ç¨‹"}},[t._v("#")]),t._v(" äº‹ä»¶å¤„ç†è¿‡ç¨‹")]),t._v(" "),a("p",[t._v("å…³äºŽ"),a("code",[t._v("macrotask")]),t._v("å’Œ"),a("code",[t._v("microtask")]),t._v("çš„ç†è§£ï¼Œå…‰è¿™æ ·çœ‹ä¼šæœ‰äº›æ™¦æ¶©éš¾æ‡‚ï¼Œç»“åˆäº‹ä»¶å¾ªåçš„æœºåˆ¶ç†è§£æ¸…æ™°å¾ˆå¤šï¼Œä¸‹é¢è¿™å¼ å›¾å¯ä»¥è¯´æ˜¯ä»‹ç»å¾—éžå¸¸æ¸…æ¥šäº†ã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/event-loop.jpg",alt:"img"}})]),t._v(" "),a("p",[t._v("æ€»ç»“èµ·æ¥ï¼Œä¸€æ¬¡äº‹ä»¶å¾ªçŽ¯çš„æ­¥éª¤åŒ…æ‹¬ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" æ£€æŸ¥macrotaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œéžç©ºåˆ™åˆ°"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("ï¼Œä¸ºç©ºåˆ™åˆ°"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" æ‰§è¡Œmacrotaskä¸­çš„ä¸€ä¸ªä»»åŠ¡\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" ç»§ç»­æ£€æŸ¥microtaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œè‹¥æœ‰åˆ™åˆ°"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("ï¼Œå¦åˆ™åˆ°"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" å–å‡ºmicrotaskä¸­çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆè¿”å›žåˆ°æ­¥éª¤"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.")]),t._v(" æ‰§è¡Œè§†å›¾æ›´æ–°\n")])])]),a("h3",{attrs:{id:"mactotask-microtask-çš„æ‰§è¡Œé¡ºåº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mactotask-microtask-çš„æ‰§è¡Œé¡ºåº"}},[t._v("#")]),t._v(" mactotask & microtask çš„æ‰§è¡Œé¡ºåº")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/ma(i)crotask.png",alt:"img"}})]),t._v(" "),a("p",[t._v("è¯»å®Œè¿™ä¹ˆå¤šå¹²å·´å·´çš„æ¦‚å¿µä»‹ç»ï¼Œè¿˜ä¸å¦‚çœ‹ä¸€æ®µä»£ç æ„Ÿå—ä¸‹")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setTimeout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æ‰“å°å°è¾“å‡ºçš„ log é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿç»“åˆä¸Šè¿°çš„æ­¥éª¤åˆ†æžï¼Œç³»ä¸ç³» so easy~"),a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/browser-deom1-excute-animate.gif",alt:"img"}})]),t._v(" "),a("p",[t._v("é¦–å…ˆï¼Œå…¨å±€ä»£ç ï¼ˆmain()ï¼‰åŽ‹å…¥è°ƒç”¨æ ˆæ‰§è¡Œï¼Œæ‰“å°"),a("code",[t._v("start")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("æŽ¥ä¸‹æ¥ setTimeout åŽ‹å…¥ macrotask é˜Ÿåˆ—ï¼Œpromise.then å›žè°ƒæ”¾å…¥ microtask é˜Ÿåˆ—ï¼Œæœ€åŽæ‰§è¡Œ console.log(â€˜endâ€™)ï¼Œæ‰“å°å‡º"),a("code",[t._v("end")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è‡³æ­¤ï¼Œè°ƒç”¨æ ˆä¸­çš„ä»£ç è¢«æ‰§è¡Œå®Œæˆï¼Œå›žé¡¾ macrotask çš„å®šä¹‰ï¼Œæˆ‘ä»¬çŸ¥é“å…¨å±€ä»£ç å±žäºŽ macrotaskï¼Œmacrotask æ‰§è¡Œå®Œï¼Œé‚£æŽ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œ microtask é˜Ÿåˆ—çš„ä»»åŠ¡äº†ï¼Œæ‰§è¡Œ promise å›žè°ƒæ‰“å°"),a("code",[t._v("promise1")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("promise å›žè°ƒå‡½æ•°é»˜è®¤è¿”å›ž undefinedï¼Œpromise çŠ¶æ€å˜ä¸º fullfill è§¦å‘æŽ¥ä¸‹æ¥çš„ then å›žè°ƒï¼Œç»§ç»­åŽ‹å…¥ microtask é˜Ÿåˆ—ï¼Œ"),a("strong",[t._v("event loop ä¼šæŠŠå½“å‰çš„ microtask é˜Ÿåˆ—ä¸€ç›´æ‰§è¡Œå®Œ")]),t._v("ï¼Œæ­¤æ—¶æ‰§è¡Œç¬¬äºŒä¸ª promise.then å›žè°ƒæ‰“å°å‡º"),a("code",[t._v("promise2")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è¿™æ—¶ microtask é˜Ÿåˆ—å·²ç»ä¸ºç©ºï¼Œä»Žä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥çŸ¥é“ï¼ŒæŽ¥ä¸‹æ¥ä¸»çº¿ç¨‹ä¼šåŽ»åšä¸€äº› UI æ¸²æŸ“å·¥ä½œï¼ˆä¸ä¸€å®šä¼šåšï¼‰ï¼Œç„¶åŽå¼€å§‹ä¸‹ä¸€è½® event loopï¼Œæ‰§è¡Œ setTimeout çš„å›žè°ƒï¼Œæ‰“å°å‡º"),a("code",[t._v("setTimeout")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è¿™ä¸ªè¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„"),a("strong",[t._v("äº‹ä»¶å¾ªçŽ¯")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"è§†å›¾æ¸²æŸ“çš„æ—¶æœº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è§†å›¾æ¸²æŸ“çš„æ—¶æœº"}},[t._v("#")]),t._v(" è§†å›¾æ¸²æŸ“çš„æ—¶æœº")]),t._v(" "),a("p",[t._v("å›žé¡¾ä¸Šé¢çš„äº‹ä»¶å¾ªçŽ¯ç¤ºæ„å›¾ï¼Œupdate renderingï¼ˆè§†å›¾æ¸²æŸ“ï¼‰å‘ç”Ÿåœ¨æœ¬è½®äº‹ä»¶å¾ªçŽ¯çš„ microtask é˜Ÿåˆ—è¢«æ‰§è¡Œå®Œä¹‹åŽï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œä»»åŠ¡çš„è€—æ—¶ä¼šå½±å“è§†å›¾æ¸²æŸ“çš„æ—¶æœºã€‚é€šå¸¸æµè§ˆå™¨ä»¥æ¯ç§’ 60 å¸§ï¼ˆ60fpsï¼‰çš„é€ŸçŽ‡åˆ·æ–°é¡µé¢ï¼Œæ®è¯´è¿™ä¸ªå¸§çŽ‡æœ€é€‚åˆäººçœ¼äº¤äº’ï¼Œå¤§æ¦‚ 16.7ms æ¸²æŸ“ä¸€å¸§ï¼Œæ‰€ä»¥å¦‚æžœè¦è®©ç”¨æˆ·è§‰å¾—é¡ºç•…ï¼Œå•ä¸ª macrotask åŠå®ƒç›¸å…³çš„æ‰€æœ‰ microtask æœ€å¥½èƒ½åœ¨ 16.7ms å†…å®Œæˆã€‚")]),t._v(" "),a("p",[t._v("ä½†ä¹Ÿä¸æ˜¯æ¯è½®äº‹ä»¶å¾ªçŽ¯éƒ½ä¼šæ‰§è¡Œè§†å›¾æ›´æ–°ï¼Œæµè§ˆå™¨æœ‰è‡ªå·±çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æŠŠå‡ æ¬¡çš„è§†å›¾æ›´æ–°ç´¯ç§¯åˆ°ä¸€èµ·é‡ç»˜ï¼Œé‡ç»˜ä¹‹å‰ä¼šé€šçŸ¥ requestAnimationFrame æ‰§è¡Œå›žè°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ requestAnimationFrame å›žè°ƒçš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸€æ¬¡æˆ–å¤šæ¬¡äº‹ä»¶å¾ªçŽ¯çš„ UI render é˜¶æ®µã€‚")]),t._v(" "),a("p",[t._v("ä»¥ä¸‹ä»£ç å¯ä»¥éªŒè¯")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timer1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"requestAnimationFrame"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timer2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise 1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise 2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise then"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* promise 1\npromise 2\nend\npromise then\nrequestAnimationFrame\ntimer1\ntimer2 */")]),t._v("\n")])])]),a("p",[t._v("å¯ä»¥çœ‹åˆ°ï¼Œç»“æžœ 1 ä¸­"),a("code",[t._v("requestAnimationFrame()")]),t._v("æ˜¯åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªçŽ¯åŽæ‰§è¡Œï¼Œè€Œåœ¨ç»“æžœ 2ï¼Œå®ƒçš„æ‰§è¡Œåˆ™æ˜¯åœ¨ä¸‰æ¬¡äº‹ä»¶å¾ªçŽ¯ç»“æŸåŽã€‚")]),t._v(" "),a("h3",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("äº‹ä»¶å¾ªçŽ¯æ˜¯ js å®žçŽ°å¼‚æ­¥çš„æ ¸å¿ƒ")])]),t._v(" "),a("li",[a("p",[t._v("æ¯è½®äº‹ä»¶å¾ªçŽ¯åˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼š")]),t._v(" "),a("blockquote",[a("p",[t._v("a) æ‰§è¡Œ macrotask é˜Ÿåˆ—çš„ä¸€ä¸ªä»»åŠ¡\nb) æ‰§è¡Œå®Œå½“å‰ microtask é˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡\nc) UI render")])])]),t._v(" "),a("li",[a("p",[t._v("æµè§ˆå™¨åªä¿è¯ requestAnimationFrame çš„å›žè°ƒåœ¨é‡ç»˜ä¹‹å‰æ‰§è¡Œï¼Œæ²¡æœ‰ç¡®å®šçš„æ—¶é—´ï¼Œä½•æ—¶é‡ç»˜ç”±æµè§ˆå™¨å†³å®š")])])]),t._v(" "),a("p",[t._v("[å‚è€ƒèµ„æ–™]")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.w3.org/TR/html5/webappapis.html#event-loops",target:"_blank",rel:"noopener noreferrer"}},[t._v("event-loops"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://ecma-international.org/ecma-262/6.0/#sec-jobs-and-job-queues",target:"_blank",rel:"noopener noreferrer"}},[t._v("sec-jobs-and-job-queues"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[t._v("Promises/A+"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tasks, microtasks, queues and schedules"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/24460769",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTML ç³»åˆ—ï¼šmacrotask å’Œ microtask"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("http://www.ruanyifeng.com/blog/2014/10/event-loop.html")])]),t._v(" "),a("h2",{attrs:{id:"æ·±å…¥ç†è§£-js-äº‹ä»¶å¾ªçŽ¯æœºåˆ¶-node-js-ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£-js-äº‹ä»¶å¾ªçŽ¯æœºåˆ¶-node-js-ç¯‡"}},[t._v("#")]),t._v(" æ·±å…¥ç†è§£ js äº‹ä»¶å¾ªçŽ¯æœºåˆ¶ï¼ˆNode.js ç¯‡ï¼‰")]),t._v(" "),a("p",[t._v("åœ¨"),a("a",{attrs:{href:"https://huang-1234.github.io/BrowserCore/Event/ajsEventLoop.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµè§ˆå™¨ç¯‡"),a("OutboundLink")],1),t._v("å·²ç»å¯¹äº‹ä»¶å¾ªçŽ¯æœºåˆ¶å’Œä¸€äº›ç›¸å…³çš„æ¦‚å¿µä½œäº†è¯¦ç»†ä»‹ç»ï¼Œä½†ä¸»è¦æ˜¯é’ˆå¯¹æµè§ˆå™¨ç«¯çš„ç ”ç©¶ï¼ŒNode çŽ¯å¢ƒæ˜¯å¦ä¹Ÿä¸€æ ·å‘¢ï¼Ÿå…ˆçœ‹ä¸€ä¸ª demoï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timer1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timer2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("è‚‰çœ¼ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œè’½ï¼Œåœ¨æµè§ˆå™¨çš„ç»“æžœå°±æ˜¯ä¸‹é¢è¿™ä¸ªäº†ï¼Œé“ç†éƒ½æ‡‚ï¼Œå°±ä¸ç´¯è¿°äº†ã€‚")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("timer1\npromise1\ntimer2\npromise2\n")])])]),a("p",[t._v("é‚£ä¹ˆ Node ä¸‹æ‰§è¡Œçœ‹çœ‹ï¼Œå’¦ã€‚ã€‚ã€‚å¥‡æ€ªï¼Œè·Ÿæµè§ˆå™¨çš„è¿è¡Œç»“æžœå¹¶ä¸ä¸€æ ·~")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("timer1\ntimer2\npromise1\npromise2\n")])])]),a("p",[t._v("ä¾‹å­è¯´æ˜Žï¼Œæµè§ˆå™¨å’Œ Node.js çš„äº‹ä»¶å¾ªçŽ¯æœºåˆ¶æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸€èµ·æ¥çœ‹ä¸ªç©¶ç«Ÿå§~")]),t._v(" "),a("h3",{attrs:{id:"node-js-çš„äº‹ä»¶å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js-çš„äº‹ä»¶å¤„ç†"}},[t._v("#")]),t._v(" Node.js çš„äº‹ä»¶å¤„ç†")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Node.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),a("OutboundLink")],1),t._v("é‡‡ç”¨ V8 ä½œä¸º js çš„è§£æžå¼•æ“Žï¼Œè€Œ I/O å¤„ç†æ–¹é¢ä½¿ç”¨äº†è‡ªå·±è®¾è®¡çš„ libuvï¼Œlibuv æ˜¯ä¸€ä¸ªåŸºäºŽäº‹ä»¶é©±åŠ¨çš„è·¨å¹³å°æŠ½è±¡å±‚ï¼Œå°è£…äº†ä¸åŒæ“ä½œç³»ç»Ÿä¸€äº›åº•å±‚ç‰¹æ€§ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„ APIï¼Œäº‹ä»¶å¾ªçŽ¯æœºåˆ¶ä¹Ÿæ˜¯å®ƒé‡Œé¢çš„å®žçŽ°ï¼Œ"),a("a",{attrs:{href:"https://github.com/libuv/libuv/blob/v1.x/src/unix/core.c#L348-L397",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ ¸å¿ƒæºç å‚è€ƒ"),a("OutboundLink")],1),t._v("ï¼š")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv_run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uv_loop_t")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uv_run_mode mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" ran_pending"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__loop_alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// timersé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_timers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// I/O callbacksé˜¶æ®µ")]),t._v("\n    ran_pending "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_pending")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// idleé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// prepareé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_prepare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ran_pending"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv_backend_timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pollé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__io_poll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// checké˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// close callbacksé˜¶æ®µ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_closing_handles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__update_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__run_timers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uv__loop_alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_ONCE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" UV_RUN_NOWAIT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("stop_flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("æ ¹æ®"),a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),a("OutboundLink")],1),t._v("å®˜æ–¹ä»‹ç»ï¼Œæ¯æ¬¡äº‹ä»¶å¾ªçŽ¯éƒ½åŒ…å«äº† 6 ä¸ªé˜¶æ®µï¼Œå¯¹åº”åˆ° libuv æºç ä¸­çš„å®žçŽ°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º")]),t._v(" "),a("p",[a("img",{attrs:{src:"ajsEventLoop.assets/node-libuv.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("timers é˜¶æ®µ")]),t._v("ï¼šè¿™ä¸ªé˜¶æ®µæ‰§è¡Œ timerï¼ˆ"),a("code",[t._v("setTimeout")]),t._v("ã€"),a("code",[t._v("setInterval")]),t._v("ï¼‰çš„å›žè°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("I/O callbacks é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œä¸€äº›ç³»ç»Ÿè°ƒç”¨é”™è¯¯ï¼Œæ¯”å¦‚ç½‘ç»œé€šä¿¡çš„é”™è¯¯å›žè°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("idle, prepare é˜¶æ®µ")]),t._v("ï¼šä»… node å†…éƒ¨ä½¿ç”¨")]),t._v(" "),a("li",[a("strong",[t._v("poll é˜¶æ®µ")]),t._v("ï¼šèŽ·å–æ–°çš„ I/O äº‹ä»¶, é€‚å½“çš„æ¡ä»¶ä¸‹ node å°†é˜»å¡žåœ¨è¿™é‡Œ")]),t._v(" "),a("li",[a("strong",[t._v("check é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œ "),a("code",[t._v("setImmediate()")]),t._v(" çš„å›žè°ƒ")]),t._v(" "),a("li",[a("strong",[t._v("close callbacks é˜¶æ®µ")]),t._v("ï¼šæ‰§è¡Œ "),a("code",[t._v("socket")]),t._v(" çš„ "),a("code",[t._v("close")]),t._v(" äº‹ä»¶å›žè°ƒ")])]),t._v(" "),a("p",[t._v("æˆ‘ä»¬é‡ç‚¹çœ‹"),a("code",[t._v("timers")]),t._v("ã€"),a("code",[t._v("poll")]),t._v("ã€"),a("code",[t._v("check")]),t._v("è¿™ 3 ä¸ªé˜¶æ®µå°±å¥½ï¼Œå› ä¸ºæ—¥å¸¸å¼€å‘ä¸­çš„ç»å¤§éƒ¨åˆ†å¼‚æ­¥ä»»åŠ¡éƒ½æ˜¯åœ¨è¿™ 3 ä¸ªé˜¶æ®µå¤„ç†çš„ã€‚")]),t._v(" "),a("h3",{attrs:{id:"timers-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timers-é˜¶æ®µ"}},[t._v("#")]),t._v(" timers é˜¶æ®µ")]),t._v(" "),a("p",[t._v("timers æ˜¯äº‹ä»¶å¾ªçŽ¯çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒNode ä¼šåŽ»æ£€æŸ¥æœ‰æ— å·²è¿‡æœŸçš„ timerï¼Œå¦‚æžœæœ‰åˆ™æŠŠå®ƒçš„å›žè°ƒåŽ‹å…¥ timer çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œäº‹å®žä¸Šï¼ŒNode å¹¶ä¸èƒ½ä¿è¯ timer åœ¨é¢„è®¾æ—¶é—´åˆ°äº†å°±ä¼šç«‹å³æ‰§è¡Œï¼Œå› ä¸º Node å¯¹ timer çš„è¿‡æœŸæ£€æŸ¥ä¸ä¸€å®šé è°±ï¼Œå®ƒä¼šå—æœºå™¨ä¸Šå…¶å®ƒè¿è¡Œç¨‹åºå½±å“ï¼Œæˆ–è€…é‚£ä¸ªæ—¶é—´ç‚¹ä¸»çº¿ç¨‹ä¸ç©ºé—²ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œ"),a("code",[t._v("setTimeout()")]),t._v(" å’Œ "),a("code",[t._v("setImmediate()")]),t._v(" çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timeout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"immediate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("ä½†æ˜¯æŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ª I/O å›žè°ƒé‡Œé¢ï¼Œå°±ä¸€å®šæ˜¯ "),a("code",[t._v("setImmediate()")]),t._v(" å…ˆæ‰§è¡Œï¼Œå› ä¸º poll é˜¶æ®µåŽé¢å°±æ˜¯ check é˜¶æ®µã€‚")]),t._v(" "),a("h3",{attrs:{id:"poll-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#poll-é˜¶æ®µ"}},[t._v("#")]),t._v(" poll é˜¶æ®µ")]),t._v(" "),a("p",[t._v("poll é˜¶æ®µä¸»è¦æœ‰ 2 ä¸ªåŠŸèƒ½ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¤„ç† poll é˜Ÿåˆ—çš„äº‹ä»¶")]),t._v(" "),a("li",[t._v("å½“æœ‰å·²è¶…æ—¶çš„ timerï¼Œæ‰§è¡Œå®ƒçš„å›žè°ƒå‡½æ•°")])]),t._v(" "),a("p",[t._v("even loop å°†åŒæ­¥æ‰§è¡Œ poll é˜Ÿåˆ—é‡Œçš„å›žè°ƒï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–æ‰§è¡Œçš„å›žè°ƒè¾¾åˆ°ç³»ç»Ÿä¸Šé™ï¼ˆä¸Šé™å…·ä½“å¤šå°‘æœªè¯¦ï¼‰ï¼ŒæŽ¥ä¸‹æ¥ even loop ä¼šåŽ»æ£€æŸ¥æœ‰æ— é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š")]),t._v(" "),a("ol",[a("li",[t._v("è‹¥æœ‰é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v(", event loop å°†ç»“æŸ poll é˜¶æ®µè¿›å…¥ check é˜¶æ®µï¼Œå¹¶æ‰§è¡Œ check é˜¶æ®µçš„ä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("li",[t._v("è‹¥æ²¡æœ‰é¢„è®¾çš„"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œevent loop å°†é˜»å¡žåœ¨è¯¥é˜¶æ®µç­‰å¾…")])]),t._v(" "),a("p",[t._v("æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œæ²¡æœ‰"),a("code",[t._v("setImmediate()")]),t._v("ä¼šå¯¼è‡´ event loop é˜»å¡žåœ¨ poll é˜¶æ®µï¼Œè¿™æ ·ä¹‹å‰è®¾ç½®çš„ timer å²‚ä¸æ˜¯æ‰§è¡Œä¸äº†äº†ï¼Ÿæ‰€ä»¥å’§ï¼Œåœ¨ poll é˜¶æ®µ event loop ä¼šæœ‰ä¸€ä¸ªæ£€æŸ¥æœºåˆ¶ï¼Œæ£€æŸ¥ timer é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æžœ timer é˜Ÿåˆ—éžç©ºï¼Œevent loop å°±å¼€å§‹ä¸‹ä¸€è½®äº‹ä»¶å¾ªçŽ¯ï¼Œå³é‡æ–°è¿›å…¥åˆ° timer é˜¶æ®µã€‚")]),t._v(" "),a("h3",{attrs:{id:"check-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check-é˜¶æ®µ"}},[t._v("#")]),t._v(" check é˜¶æ®µ")]),t._v(" "),a("p",[a("code",[t._v("setImmediate()")]),t._v("çš„å›žè°ƒä¼šè¢«åŠ å…¥ check é˜Ÿåˆ—ä¸­ï¼Œ ä»Ž event loop çš„é˜¶æ®µå›¾å¯ä»¥çŸ¥é“ï¼Œcheck é˜¶æ®µçš„æ‰§è¡Œé¡ºåºåœ¨ poll é˜¶æ®µä¹‹åŽã€‚")]),t._v(" "),a("h3",{attrs:{id:"å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[t._v("#")]),t._v(" å°ç»“")]),t._v(" "),a("ul",[a("li",[t._v("event loop çš„æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—")]),t._v(" "),a("li",[t._v("å½“ event loop åˆ°è¾¾æŸä¸ªé˜¶æ®µæ—¶ï¼Œå°†æ‰§è¡Œè¯¥é˜¶æ®µçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œç›´åˆ°é˜Ÿåˆ—æ¸…ç©ºæˆ–æ‰§è¡Œçš„å›žè°ƒè¾¾åˆ°ç³»ç»Ÿä¸Šé™åŽï¼Œæ‰ä¼šè½¬å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ")]),t._v(" "),a("li",[t._v("å½“æ‰€æœ‰é˜¶æ®µè¢«é¡ºåºæ‰§è¡Œä¸€æ¬¡åŽï¼Œç§° event loop å®Œæˆäº†ä¸€ä¸ª tick")])]),t._v(" "),a("p",[t._v("è®²å¾—å¥½æœ‰é“ç†ï¼Œå¯æ˜¯æ²¡æœ‰ demo æˆ‘è¿˜æ˜¯ç†è§£ä¸å…¨å•Šï¼Œæ†‹æ€¥ï¼Œnowï¼")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"readFile"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timeout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"immediate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æ‰§è¡Œç»“æžœåº”è¯¥éƒ½æ²¡æœ‰ç–‘é—®äº†")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("readFile\nimmediate\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),t._v("\n")])])]),a("h2",{attrs:{id:"node-js-ä¸Žæµè§ˆå™¨çš„-event-loop-å·®å¼‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js-ä¸Žæµè§ˆå™¨çš„-event-loop-å·®å¼‚"}},[t._v("#")]),t._v(" Node.js ä¸Žæµè§ˆå™¨çš„ Event Loop å·®å¼‚")]),t._v(" "),a("p",[t._v("å›žé¡¾ä¸Šä¸€ç¯‡ï¼Œæµè§ˆå™¨çŽ¯å¢ƒä¸‹ï¼Œ"),a("code",[t._v("microtask")]),t._v("çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯æ¯ä¸ª"),a("code",[t._v("macrotask")]),t._v("æ‰§è¡Œå®Œä¹‹åŽæ‰§è¡Œã€‚")]),t._v(" "),a("p",[a("img",{attrs:{src:"ajsEventLoop.assets/ma(i)crotask.png",alt:"æµè§ˆå™¨ç«¯"}})]),t._v(" "),a("p",[t._v("è€Œåœ¨ Node.js ä¸­ï¼Œ"),a("code",[t._v("microtask")]),t._v("ä¼šåœ¨äº‹ä»¶å¾ªçŽ¯çš„å„ä¸ªé˜¶æ®µä¹‹é—´æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šåŽ»æ‰§è¡Œ"),a("code",[t._v("microtask")]),t._v("é˜Ÿåˆ—çš„ä»»åŠ¡ã€‚"),a("img",{attrs:{src:"ajsEventLoop.assets/ma(i)crotask-in-node.png",alt:"Node.jsç«¯"}})]),t._v(" "),a("h3",{attrs:{id:"demo-å›žé¡¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo-å›žé¡¾"}},[t._v("#")]),t._v(" demo å›žé¡¾")]),t._v(" "),a("p",[t._v("å›žé¡¾æ–‡ç« æœ€å¼€å§‹çš„ demoï¼Œå…¨å±€è„šæœ¬ï¼ˆmain()ï¼‰æ‰§è¡Œï¼Œå°† 2 ä¸ª timer ä¾æ¬¡æ”¾å…¥ timer é˜Ÿåˆ—ï¼Œmain()æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨æ ˆç©ºé—²ï¼Œä»»åŠ¡é˜Ÿåˆ—å¼€å§‹æ‰§è¡Œï¼›")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/node-excute-animate.gif",alt:"Node.jsä¸‹çš„å¤„ç†è¿‡ç¨‹"}})]),t._v(" "),a("p",[t._v("é¦–å…ˆè¿›å…¥ timers é˜¶æ®µï¼Œæ‰§è¡Œ timer1 çš„å›žè°ƒå‡½æ•°ï¼Œæ‰“å°"),a("code",[t._v("timer1")]),t._v("ï¼Œå¹¶å°† promise1.then å›žè°ƒæ”¾å…¥ microtask é˜Ÿåˆ—ï¼ŒåŒæ ·çš„æ­¥éª¤æ‰§è¡Œ timer2ï¼Œæ‰“å°"),a("code",[t._v("timer2")]),t._v("ï¼›")]),t._v(" "),a("p",[t._v("è‡³æ­¤ï¼Œtimer é˜¶æ®µæ‰§è¡Œç»“æŸï¼Œevent loop è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µä¹‹å‰ï¼Œæ‰§è¡Œ"),a("code",[t._v("microtask")]),t._v("é˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡ï¼Œä¾æ¬¡æ‰“å°"),a("code",[t._v("promise1")]),t._v("ã€"),a("code",[t._v("promise2")]),t._v("ã€‚")]),t._v(" "),a("p",[t._v("å¯¹æ¯”æµè§ˆå™¨ç«¯çš„å¤„ç†è¿‡ç¨‹ï¼š"),a("img",{attrs:{src:"http://lynnelv.github.io/img/article/event-loop/browser-excute-animate.gif",alt:"Browserä¸‹çš„å¤„ç†è¿‡ç¨‹"}})]),t._v(" "),a("h3",{attrs:{id:"process-nexttick-vs-setimmediate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#process-nexttick-vs-setimmediate"}},[t._v("#")]),t._v(" process.nextTick() VS setImmediate()")]),t._v(" "),a("blockquote",[a("p",[t._v("In essence, the names should be swapped. process.nextTick() fires more immediately than setImmediate()")])]),t._v(" "),a("p",[t._v("æ¥è‡ªå®˜æ–¹æ–‡æ¡£æœ‰æ„æ€çš„ä¸€å¥è¯ï¼Œä»Žè¯­ä¹‰è§’åº¦çœ‹ï¼Œ"),a("code",[t._v("setImmediate()")]),t._v(" åº”è¯¥æ¯” "),a("code",[t._v("process.nextTick()")]),t._v(" å…ˆæ‰§è¡Œæ‰å¯¹ï¼Œè€Œäº‹å®žç›¸åï¼Œå‘½åæ˜¯åŽ†å²åŽŸå› ä¹Ÿå¾ˆéš¾å†å˜ã€‚")]),t._v(" "),a("p",[a("code",[t._v("process.nextTick()")]),t._v(" ä¼šåœ¨å„ä¸ªäº‹ä»¶é˜¶æ®µä¹‹é—´æ‰§è¡Œï¼Œä¸€æ—¦æ‰§è¡Œï¼Œè¦ç›´åˆ° nextTick é˜Ÿåˆ—è¢«æ¸…ç©ºï¼Œæ‰ä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶é˜¶æ®µï¼Œæ‰€ä»¥å¦‚æžœé€’å½’è°ƒç”¨ "),a("code",[t._v("process.nextTick()")]),t._v("ï¼Œä¼šå¯¼è‡´å‡ºçŽ° I/O starvingï¼ˆé¥¥é¥¿ï¼‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢ä¾‹å­çš„ readFile å·²ç»å®Œæˆï¼Œä½†å®ƒçš„å›žè°ƒä¸€ç›´æ— æ³•æ‰§è¡Œï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" starttime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" endtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  endtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"finish reading time: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" starttime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("nextTick ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log(`setImmediate ${index}`)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setImmediate(handler)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("process.nextTick()")]),t._v("çš„è¿è¡Œç»“æžœï¼š")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("nextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("999")]),t._v("\nnextTick "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nfinish reading time: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("170")]),t._v("\n")])])]),a("p",[t._v("æ›¿æ¢æˆ"),a("code",[t._v("setImmediate()")]),t._v("ï¼Œè¿è¡Œç»“æžœï¼š")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("setImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\nfinish reading time: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("999")]),t._v("\nsetImmediate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n")])])]),a("p",[t._v("è¿™æ˜¯å› ä¸ºåµŒå¥—è°ƒç”¨çš„ "),a("code",[t._v("setImmediate()")]),t._v(" å›žè°ƒï¼Œè¢«æŽ’åˆ°äº†ä¸‹ä¸€æ¬¡ event loop æ‰æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°é˜»å¡žã€‚")]),t._v(" "),a("h3",{attrs:{id:"æ€»ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-2"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Node.js çš„äº‹ä»¶å¾ªçŽ¯åˆ†ä¸º 6 ä¸ªé˜¶æ®µ")])]),t._v(" "),a("li",[a("p",[t._v("æµè§ˆå™¨å’Œ Node çŽ¯å¢ƒä¸‹ï¼Œ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("microtask\n")])])])])]),t._v(" "),a("p",[t._v("ä»»åŠ¡é˜Ÿåˆ—çš„æ‰§è¡Œæ—¶æœºä¸åŒ")]),t._v(" "),a("ul",[a("li",[t._v("Node.js ä¸­ï¼Œ"),a("code",[t._v("microtask")]),t._v(" åœ¨äº‹ä»¶å¾ªçŽ¯çš„å„ä¸ªé˜¶æ®µä¹‹é—´æ‰§è¡Œ")]),t._v(" "),a("li",[t._v("æµè§ˆå™¨ç«¯ï¼Œ"),a("code",[t._v("microtask")]),t._v(" åœ¨äº‹ä»¶å¾ªçŽ¯çš„ "),a("code",[t._v("macrotask")]),t._v(" æ‰§è¡Œå®Œä¹‹åŽæ‰§è¡Œ")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("é€’å½’çš„è°ƒç”¨"),a("code",[t._v("process.nextTick()")]),t._v("ä¼šå¯¼è‡´ I/O starvingï¼Œå®˜æ–¹æŽ¨èä½¿ç”¨"),a("code",[t._v("setImmediate()")])])]),t._v(" "),a("p",[t._v("[å‚è€ƒèµ„æ–™]")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/",target:"_blank",rel:"noopener noreferrer"}},[t._v("event-loop-timers-and-nexttick"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://cnodejs.org/topic/57d68794cb6f605d360105bf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js Event Loop çš„ç†è§£ Timersï¼Œprocess.nextTick()"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/libuv/libuv/blob/v1.x/src/unix/core.c",target:"_blank",rel:"noopener noreferrer"}},[t._v("libuv/core.c"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/nodejs/node/blob/master/lib/internal/process/next_tick.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs/next_tick.js"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);